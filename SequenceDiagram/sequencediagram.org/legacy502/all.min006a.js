//Copyright SequenceDiagram.org
var SEQ=SEQ||{};SEQ.main=function(){function a(a){fa=a}function b(){return document.getElementById("diagramCanvas")}function c(){return fa?fa:b().getContext("2d")}function d(){return document.getElementById("interactionCanvas")}function e(){return d().getContext("2d")}function f(){return document.getElementById("participantCanvas")}function g(){return f().getContext("2d")}function h(a){var b=R.getScrollInfo();R.setValue(a),R.scrollTo(b.left,b.top)}function i(a,b){if(da.length>0)var c=da[da.length-1];a!=c&&(b||(ea=[]),da.push(a)),da.length>=100&&da.shift()}function j(a){if(ea.length>0)var b=ea[ea.length-1];a!=b&&ea.push(a),ea.length>=100&&ea.shift()}function k(){if(da.length>=2){var a=da.pop();j(a);var b=da.pop();h(b),SEQ.parser.parse(!0)}}function l(){if(ea.length>0){var a=ea.pop();h(a),SEQ.parser.parse(!0)}}function m(a){var b=SEQ.parser.diagram.fontFamily;return a+"pt "+b}function n(a){ca.INCREASE===a?$<72&&($++,SEQ.parser.parse()):ca.DECREASE===a&&$>4&&($--,SEQ.parser.parse())}function o(){document.getElementById("cover").style.display="none";var a=document.getElementById("imageSavePopup");a&&(a.style.display="none");var b=document.getElementById("infoPopup");b&&(b.style.display="none");var c=document.getElementById("shareUrlPopup");c&&(c.style.display="none");var d=document.getElementById("instructionsPopup");d&&(d.style.display="none")}function p(){var a,c=b(),d=q().imgtype,e=q().imgquality;a=d&&e?c.toDataURL(d,parseFloat(e.replace("#",""))):c.toDataURL();var f=document.getElementById("imageDiv"),g=document.getElementById("diagramImage");g&&f.removeChild(g);var h=800/c.width,i=600/c.height,j=h<i?h:i,k=document.createElement("img");k.src=a,k.style.width=j*c.width+"px",k.style.height=j*c.height+"px",k.id="diagramImage",f.appendChild(k),document.getElementById("cover").style.display="block",document.getElementById("imageSavePopup").style.display="block"}function q(){var a={};return window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(b,c,d){a[c]=d}),a}function r(){var a=document.getElementById("linkWithName");SEQ.parser.diagram.title&&(a.innerHTML=SEQ.parser.diagram.title.title);var b=I(),c=LZString.compressToEncodedURIComponent(b),d=window.location.href;d.indexOf("index.html")>-1&&(d=d.substring(0,d.indexOf("index.html"))),d.indexOf("#")>-1&&(d=d.substring(0,d.indexOf("#"))),"/"!==d.substring(d.length-1,d.length)&&(d+="/");var e=d+"index.html?initialData="+c;a.href=e,document.getElementById("cover").style.display="block",document.getElementById("shareUrlPopup").style.display="block";var f=document.getElementById("shareRawUrl");f.value=e,f.setSelectionRange(0,f.value.length),f.focus()}function s(){var a=q().initialData,c=q().format;if(a)if(0===a.indexOf("http://")||0===a.indexOf("https://")){var d=new XMLHttpRequest;d.open("GET",a,!0),d.onreadystatechange=function(){if(4==this.readyState&&200==this.status&&(SEQ.main.updateSource(this.responseText),SEQ.parser.parse(),"png"===c)){var a=b();window.location.href=a.toDataURL("image/png")}},d.send()}else{var e=LZString.decompressFromEncodedURIComponent(a);SEQ.main.updateSource(e)}else{var f="C4S2BsFMAIBUAsQGdrOgQ2qCkBQuBBcEAY0gFoA+AIQHsAjALgGFiSBrDAOwBNoeATugDmWWtBIDI6YDExSAjgFdISYNFoCAOl2ABPAA4wwqLlngwktJQLIYpmYOOAXoUAGbBCbSAB5y5HRMgiJi0AC2tABueFy0shoxAtBBADQAItb0UBJsnE7QkDwmsgAewCx55jAAVDUA-HWoJLRm7prQdSBcagJKJKCtSE3ovJ01kKXo4QZQwzVAA",g=LZString.decompressFromEncodedURIComponent(f);SEQ.main.updateSource(g)}}function t(){return m($)}function u(){return $+"pt sans-serif"}function v(){return m($*_)}function w(){return m($*aa)}function x(){return m($*ba)}function y(){return $}function z(){SEQ.interactor.editEntryTextAreaActive()||(Q&&clearTimeout(Q),Q=setTimeout(SEQ.parser.parse,50))}function A(){return document.getElementById("syntaxErrors")}function B(a){var b=A();a.length>0?(b.style.background="rgba(240, 200, 200, 0.9)",b.style.cursor="pointer",b.style.textDecoration="underline"):(b.style.background="rgba(255, 255, 255, 0.9)",b.style.cursor="default",b.style.textDecoration="none"),Z||R.clearGutter("errors");var c="",d=0;a.forEach(function(b){Z||R.setGutterMarker(b.lineNumber-1,"errors",C()),d++;var e="line "+b.lineNumber+": "+b.line;c+=d<a.length?e+"\n":e}),b.value=c}function C(){var a=document.createElement("div");return a.style.color="red",a.innerHTML="âŠ ",a}function D(){var a=document.getElementById("top");a.style.display="none";var b=document.getElementById("actions");b.style.top="5px";var c=A();c.style.top="5px";var d=document.getElementById("source");d.style.top="55px";var e=document.getElementById("handleWrapper");e.style.top="55px";var f=document.getElementById("diagramCanvas");f.style.top="5px";var g=document.getElementById("interactionCanvasWrapper");g.style.top="5px",SEQ.interactor.onWindowScroll()}function E(){var a=f(),b=document.getElementById("partcipantOverlayCheckbox");b.checked?a.style.display="block":a.style.display="none"}function F(a){var b=document.createElement("textarea");b.style.position="fixed",b.style.top=0,b.style.left=0,b.style.width="2em",b.style.height="2em",b.style.padding=0,b.style.border="none",b.style.outline="none",b.style.boxShadow="none",b.style.background="transparent",b.value=a,document.body.appendChild(b),b.select(),document.execCommand("copy"),document.body.removeChild(b)}function G(a){var b=R.getValue()+a;h(b),z()}function H(a){var b=a+R.getValue();h(b),z()}function I(){return R.getValue()}function J(){return R.getInputField().blur()}function K(){return R.getInputField().focus()}function L(a,b,c){R.setSelection({line:a,ch:b},{line:a,ch:c})}function M(a){var b=a.clientX-T,c=a.clientY-U;S.style.width=V+b+"px",S.style.top=W+c+"px",R.setSize(X+b+"px",Y+c+"px"),a.preventDefault()}function N(a){T=a.clientX,U=a.clientY,V=parseInt(S.style.width,10),W=parseInt(S.style.top,10);var b=document.getElementsByClassName("CodeMirror")[0];X=parseInt(b.style.width,10),Y=parseInt(b.style.height,10),document.addEventListener("mousemove",M),document.addEventListener("mouseup",O),a.preventDefault()}function O(a){document.removeEventListener("mousemove",M),document.removeEventListener("mouseup",O),a.preventDefault()}function P(){CodeMirror.commands.autocomplete=function(a){a.showHint({hint:CodeMirror.hint.seqdiahint,completeSingle:!1})},R=Z?CodeMirror(document.getElementById("source"),{value:"# Loading...",styleActiveLine:{nonEmpty:!0},lineNumbers:!0,lineWrapping:!0,extraKeys:{"Ctrl-Space":"autocomplete"},undoDepth:0}):CodeMirror(document.getElementById("source"),{value:"# Loading...",styleActiveLine:{nonEmpty:!0},lineNumbers:!0,lineWrapping:!0,extraKeys:{"Ctrl-Space":"autocomplete"},gutters:["CodeMirror-linenumbers","errors"],undoDepth:0}),R.on("keyup",function(a,b){b.keyCode>=37&&b.keyCode<=40||z()}),R.on("inputRead",function(){CodeMirror.commands.autocomplete(R)});var a=350,b=550;R.setSize(a+"px",b+"px"),S=document.getElementById("handle"),S.style.width=a+"px",S.style.top=b+"px",S.addEventListener("mousedown",N)}var Q,R,S,T,U,V,W,X,Y,Z=navigator.userAgent.toLowerCase().indexOf("firefox")>-1,$=11,_=.8,aa=1.2,ba=1.5,ca={INCREASE:"+",DECREASE:"-"},da=[],ea=[],fa=null;return{init:function(){SEQ.seqDiaHint.init(),SEQ.seqDiaMode.init(),P(),SEQ.interactor.init(),SEQ.contextMenu.init()},parse:z,getDiagramContext:c,getDiagramCanvas:b,getSourceValue:I,selectInSource:L,blurEditor:J,focusEditor:K,getInteractionCanvas:d,getInteractionContext:e,getParticipantCanvas:f,getParticipantContext:g,FontChange:ca,changeFontSize:n,exportDiagram:p,closeDiagramImagePopup:o,minimizeTop:D,getFontSize:y,getFontSansSerifNormal:u,getFontNormal:t,getFontSmall:v,getFontBig:w,getFontTitle:x,fontSizeTitleRatio:ba,createShareUrl:r,loadInitialData:s,updateSyntaxErrors:B,updateSource:h,pushUndoChange:i,undoChange:k,redoChange:l,copyTextToClipboard:F,appendToSource:G,prependToSource:H,toggleParticipantOverlay:E,setCanvasToSvgContext:a,getSyntaxErrorsTextarea:A}}();var SEQ=SEQ||{};SEQ.metrics=function(){function a(a){var b=document.createElement("canvas"),c=2*SEQ.main.getFontSize(),d=2*SEQ.main.getFontSize();b.height=c,b.width=d;var e=b.getContext("2d");e.fillRect(0,0,d,c),e.textBaseline="top",e.fillStyle="white",e.font=a,e.fillText("Pp",0,0);for(var f=e.getImageData(0,0,d,c).data,g=-1,h=0;h<c;h++){for(var i=!1,j=0;j<d;j++){var k=4*(h*d+j);0!=f[k]&&(g==-1&&(g=h),i=!0)}if(g!=-1&&!i)return h-g}return c}function b(){var b=SEQ.main.getFontNormal(),c=1.1668*a(b),f=SEQ.main.getInteractionContext();f.font=b;var g=SEQ.main.getDiagramContext();g.font=b,d.textLineHeight=c,d.textSmallLineHeight=.85*c,d.textBigLineHeight=1.25*c;var h=SEQ.main.getFontSansSerifNormal(),i=1.1668*a(h);d.baseSpaceMetric=i,d.textTopBottomPadding=.3*i,d.textPosYOffset=.1*i,d.fragmentTextPosYOffset=.4*i,d.entityMarginTop=i*e.spacingRation*SEQ.parser.diagram.entrySpacingRatio,d.textPadding=i/2,d.boxBleed=.9*i,d.entryMarginSide=i/2,d.diagramMarginTop=i/2,d.diagramMarginBottom=3.5*i,d.diagramLineDashWidth=i/1.3,d.diagramLineSpaceWidth=i/3,d.diagramLineWeight=i/12,d.participantMarginTop=i/2,d.participantMarginSide=i/2,d.participantMarginBottom=i/2,d.participantPadding=i,d.participantTopBottomPadding=.7*i,d.participantImageHeight=4.5*i,d.participantTypeLineWeight=.17*i,d.participantBoxLineWeight=.16*i,d.messageSelfRefHeight=i,d.messageSelfRefWidth=4*i,d.messageSelfRefSideMargin=i/2,d.messageArrowWidth=i/1.2,d.messageLineDashWidth=i/2.5,d.messageInteractionMargin=i/10,d.messageCreatorInteractionMargin=1.5*i,d.messageCreatorPosDiffThreshold=.2*i,d.dragAndDropInteractionMargin=3*i,d.dividerBleed=2*i,d.dividerLineSpacing=i/3,d.fragmentLineWeight=i/7,d.fragmentBleed=3.5*i,d.fragmentMarginSide=i,d.fragmentElseLineDashWidth=i/4,d.fragmentLabelEdgeLength=.6*i,d.fragmentLabelSmallHeight=.6*i,d.fragmentLabelSidePadding=i,d.fragmentHeight=1.2*i,d.fragmentTextSideMargin=i,d.collisionBleed=i/3,d.fragmentCollisionLineCompensation=i/2,d.noteOverCollisionLineCompensation=i/5,d.entryMoverXCollisionWidth=i,d.entryMoverThreshold=i/3,d.activationSideWidth=i/2,d.activationAfterHeight=1.2*i}function c(a,b){var c,d=SEQ.main.getDiagramContext();return b?(d.save(),d.font=b,c=d.measureText(a),d.restore()):c=d.measureText(a),c.width}var d={},e={entrySpacingRatio:1,spacingRation:1.5};return{setupAllMetrics:b,calcWidth:c,data:d,constants:e}}();var SEQ=SEQ||{};SEQ.parser=function(){function a(a){function c(a){for(var j=a;j<t.length;j++){var k,l=t[j];if(k=SEQ.entityTitle.parse(l))g.title=k,i(k);else if(k=SEQ.entityFontFamily.parse(l))g.fontFamily=k.fontFamily,SEQ.metrics.setupAllMetrics(),i(k);else if(k=SEQ.entityEntrySpacing.parse(l))g.entrySpacingRatio=k.entrySpacing,SEQ.metrics.setupAllMetrics(),i(k);else if(k=SEQ.entityParticipantSpacing.parse(l))g.participantSpacing=k.participantSpacing,i(k);else if(k=SEQ.entityFontSize.parse(l))i(k);else if(k=SEQ.entityMessage.parse(l,p,m,n,o))i(k),m&&n++;else if(k=SEQ.entityAutoNumber.parse(l))m=k.enabled,m&&(isNaN(k.value)||(n=k.value)),i(k);else if(k=SEQ.entityLinear.parse(l))o=k.enabled,i(k);else if(k=SEQ.entityParallel.parse(l))p=k.enabled,i(k);else if(k=SEQ.entityNoteBoxLeftRight.parse(l,p))i(k);else if(k=SEQ.entityNoteBoxOver.parse(l,p))i(k);else if(k=SEQ.entityParticipant.parse(l,j,c)){if(i(k),k.loadingImage)return}else(k=SEQ.entityDivider.parse(l))?i(k):(k=SEQ.entityFragment.parse(l,u))?i(k):(k=SEQ.entityActivation.parse(l))?i(k):(k=SEQ.entitySpace.parse(l))?i(k):(i({raw:l}),e.exec(l)||f.exec(l)||g.errors.push({lineNumber:j+1,line:l}))}g.participants.length>0?(SEQ.entityFragment.updateParticipantWidths(),b()):g.title||(g.title=SEQ.entityTitle.parse("title Empty diagram, click the ? icon for instructions and examples")),SEQ.main.updateSyntaxErrors(g.errors);for(var q in h)if(h.hasOwnProperty(q)){var r=h[q];r.inUse||delete h[q]}SEQ.painter.paint(),d.ongoing=!1}function i(a){var b=g.participantMaxHeight+SEQ.metrics.data.participantMarginTop;if(a.type&&a.type!=SEQ.entityParticipant.Type.PARTICIPANT){j(a);var c=l();if(k(c,a),a.parallel&&c&&c.parallel)a.posY=u+b;else if(a.linear&&null!=a.linearRequiredHeight&&c&&c.linear){a.posY=u+a.linearRequiredHeight+b,u=a.posY-b;for(var d,e=a.fromParticipantName===a.toParticipantName?a.posY-SEQ.metrics.data.messageSelfRefHeight:a.posY,f=g.entries.length-1;f>=0;f--){var h=g.entries[f];if(h.type){if(!h.linear||d&&d.type&&null==d.linearRequiredHeight)break;h.posY=e,d=h}}}else a.posY=u+a.topMargin+a.totalHeight+b,u=a.posY-b}else a.posY=u+b;g.entries.push(a)}function j(a){a.updateActivationPosDiff&&a.updateActivationPosDiff(a),a.updateEnclosingFragments&&a.updateEnclosingFragments(a),a.updateParticipantWidths&&a.updateParticipantWidths(a)}function k(a,b){a&&a.message&&b.activation&&(b.fromParticipantName==a.fromParticipantName||b.fromParticipantName==a.toParticipantName)&&(a.updateActivationPosDiff&&a.updateActivationPosDiff(a,b),a.updateEnclosingFragments&&a.updateEnclosingFragments(a),a.updateParticipantWidths&&a.updateParticipantWidths(a))}function l(){for(var a=g.entries.length-1;a>=0;a--){var b=g.entries[a];if(b.type&&!b.activation)return b}}SEQ.interactor.cancelAllInteraction(),g.entrySpacingRatio=SEQ.metrics.constants.entrySpacingRatio,g.fontFamily="sans-serif",SEQ.metrics.setupAllMetrics(),d.ongoing=!0,g.entries=[],g.errors=[],g.participantsByName={},g.participants=[],g.ongoingFragments=[],g.fragments=[],g.ongoingActivations={},g.title=null,g.participantSpacing=0,g.participantMaxHeight=SEQ.metrics.data.textLineHeight+SEQ.metrics.data.textTopBottomPadding+2*SEQ.metrics.data.participantTopBottomPadding+SEQ.metrics.data.participantTypeLineWeight;var m=!1,n=1,o=!1,p=!1;for(var q in h)if(h.hasOwnProperty(q)){var r=h[q];r.inUse=!1}var s=SEQ.main.getSourceValue();SEQ.main.pushUndoChange(s,a);var t=s.split("\n"),u=SEQ.metrics.data.diagramMarginTop;c(0)}function b(){function a(a){var b=a>0?c[a-1]:null,d=c[a],e=(b?b.width/2+SEQ.metrics.data.participantMarginSide:0)+d.width/2+SEQ.metrics.data.participantMarginSide,f=b&&b.entityRightWidth>d.entityLeftWidth?b.entityRightWidth:d.entityLeftWidth;b&&(f+=b.timelineRightWidth),f+=d.timelineLeftWidth;var g=Math.max(e,f);return{participantsWidth:e,largestSideWidth:g}}var b=0,c=g.participants;if(g.participantSpacing==SEQ.entityParticipantSpacing.equal){for(var d=0,e=0;e<c.length;e++){var f=a(e);f.largestSideWidth>d&&(d=f.largestSideWidth)}for(var h=0;h<c.length;h++)h>0?(b+=d,c[h].posX=b):(b+=a(h).largestSideWidth,c[h].posX=b)}else for(var i=0;i<c.length;i++){var j=i>0?c[i-1]:null,k=c[i],l=a(i),m=l.largestSideWidth,n=l.participantsWidth-SEQ.metrics.data.participantMarginSide,o=m-n;j&&g.participantSpacing*SEQ.metrics.constants.spacingRation>o/SEQ.metrics.data.baseSpaceMetric&&(m=g.participantSpacing*SEQ.metrics.data.baseSpaceMetric*SEQ.metrics.constants.spacingRation+n),b+=m,k.posX=b}}function c(a){return a in SEQ.parser.diagram.participantsByName}var d={ongoing:!1},e=new RegExp("^\\s*$"),f=new RegExp("^\\s*((:?#|//).*)$"),g={},h={};return{parse:a,diagram:g,participantExists:c,parsingState:d,imageCache:h,regExpComment:f}}();var SEQ=SEQ||{};SEQ.entityParticipant=function(){function a(a,b,d){var e=p.exec(a);if(null!=e&&e.length>q.ALIAS){var f=e[q.TYPE],g=e[q.ALIAS],h=e[q.LONG_NAME],i=e[q.COLOR_NAME],j=e[q.COLOR_HEX],k=i?i:j,l=h&&(h.indexOf("http://")>-1||h.indexOf("https://")>-1||h.indexOf("file://")>-1),m={type:r.PARTICIPANT,fromParticipantName:g,raw:a};if(l){var n=SEQ.parser.imageCache[h];if(n)return n.inUse=!0,c(g,0,0,m,null,k,n.image),m;m.loadingImage=!0;var o=b+1,s=new Image;return s.crossOrigin="Anonymous",s.onerror=function(){var a=SEQ.textUtil.parseTextData("Error loading image");c(g,0,0,m,a,k),d(o)},s.onload=function(){SEQ.parser.imageCache[h]={image:s,inUse:!0},c(g,0,0,m,null,k,s),d(o)},s.src=h,m}if(h)var t=SEQ.textUtil.parseTextData(h);return f!=r.PARTICIPANT?c(g,0,0,m,t,k,null,SEQ.participantTypes[f]):c(g,0,0,m,t,k),m}}function b(a,b,c){SEQ.parser.participantExists(a)||d(a);var e=SEQ.parser.diagram.participantsByName[a];e.timelineLeftWidth<b&&(e.timelineLeftWidth=b),e.timelineRightWidth<c&&(e.timelineRightWidth=c)}function c(a,b,c,f,g,h,i,j){SEQ.parser.participantExists(a)||d(a,f,g,h,i,j);var k=SEQ.parser.diagram.participantsByName[a];e(k,b,c)}function d(a,b,c,d,e,f){var g,h;if(e)g=SEQ.metrics.data.participantImageHeight/e.height*e.width,h=SEQ.metrics.data.participantImageHeight;else if(f){var i,j=f.width();c?(i=c.width,h=f.height()+c.height):(i=SEQ.metrics.calcWidth(a),h=f.height()+SEQ.metrics.data.textLineHeight+SEQ.metrics.data.textTopBottomPadding),g=j>i?j:i}else c?(g=c.width+2*SEQ.metrics.data.participantPadding+SEQ.metrics.data.participantTypeLineWeight,h=c.height+2*SEQ.metrics.data.participantTopBottomPadding+SEQ.metrics.data.participantBoxLineWeight):(g=SEQ.metrics.calcWidth(a)+2*SEQ.metrics.data.participantPadding+SEQ.metrics.data.participantTypeLineWeight,h=SEQ.metrics.data.textLineHeight+SEQ.metrics.data.textTopBottomPadding+2*SEQ.metrics.data.participantTopBottomPadding+SEQ.metrics.data.participantTypeLineWeight);var k={type:SEQ.entityParticipant.Type.PARTICIPANT,name:a,font:SEQ.main.getFontNormal(),width:g,height:h,entityLeftWidth:0,entityRightWidth:0,timelineLeftWidth:0,timelineRightWidth:0,longNameTextData:c,image:e,participantType:f,color:d,entry:b};h>SEQ.parser.diagram.participantMaxHeight&&(SEQ.parser.diagram.participantMaxHeight=h),SEQ.parser.diagram.participantsByName[a]=k,SEQ.parser.diagram.participants.push(k)}function e(a,b,c){a.entityLeftWidth<b&&(a.entityLeftWidth=b),a.entityRightWidth<c&&(a.entityRightWidth=c)}function f(a,b,c){SEQ.parser.participantExists(a)||d(a),SEQ.parser.participantExists(b)||d(b);var f,h=SEQ.parser.diagram.participantsByName[a],i=SEQ.parser.diagram.participantsByName[b],j=SEQ.parser.diagram.participants.indexOf(h),k=SEQ.parser.diagram.participants.indexOf(i),l=Math.abs(j-k);if(l>2){var m=g(j,k,SEQ.parser.diagram.participants),n=c-m;f=n/2}else f=2===l?c/2:c;f>0&&(j<k?(e(h,0,f),e(i,f,0)):(e(h,f,0),e(i,0,f)))}function g(a,b){for(var c=a<b?{low:a,high:b}:{low:b,high:a},d=0,e=c.low+1;e<=c.high;e++){var f=SEQ.parser.diagram.participants[e-1],g=SEQ.parser.diagram.participants[e];if(e!=c.low+1&&e!=c.high){var h=(f?f.width/2+SEQ.metrics.data.participantMarginSide:0)+g.width/2+SEQ.metrics.data.participantMarginSide,i=f&&f.entityRightWidth>g.entityLeftWidth?f.entityRightWidth:g.entityLeftWidth;d+=Math.max(h,i)}}return d}function h(a,b,c){var d=SEQ.metrics.data,e=d.participantMarginTop;if(SEQ.parser.diagram.title&&!c&&(e+=SEQ.parser.diagram.title.totalHeight),a.image){e+=SEQ.parser.diagram.participantMaxHeight-SEQ.metrics.data.participantImageHeight;var f=a.posX-a.width/2;b.beginPath(),b.save(),b.rect(f,e,a.width,a.height),b.fillStyle="white",b.fill(),b.restore(),b.drawImage(a.image,f,e,a.width,a.height)}else a.participantType?(a.participantType.paint(b,a,SEQ.parser.diagram.participantMaxHeight,e),i(a,b,SEQ.parser.diagram.participantMaxHeight,e)):(j(a,b,SEQ.parser.diagram.participantMaxHeight,e),e-=SEQ.metrics.data.participantTopBottomPadding,i(a,b,SEQ.parser.diagram.participantMaxHeight,e))}function i(a,b,c,d){if(b.save(),a.longNameTextData)SEQ.textUtil.fillTextParticipant(b,a.longNameTextData.parsedLines,a.posX,d+c-a.longNameTextData.height);else{var e=SEQ.metrics.calcWidth(a.name,a.font);b.font=a.font,b.fillText(a.name,a.posX-e/2,d+c-SEQ.metrics.data.textTopBottomPadding)}b.restore()}function j(a,b,c,d){var e=d+c-a.height+SEQ.metrics.data.participantTypeLineWeight,f=a.width;b.beginPath(),b.save(),b.rect(a.posX-f/2,e,f,a.height-SEQ.metrics.data.participantTypeLineWeight),a.color?b.fillStyle=a.color:b.fillStyle="white",b.fill(),b.lineWidth=SEQ.metrics.data.participantBoxLineWeight,b.stroke(),b.restore()}function k(a,b,c){for(var d=SEQ.parser.diagram.participants,e=0;e<d.length;e++){var f=d[e],g=[];SEQ.parser.diagram.entries.forEach(function(a){a.activation&&a.fromParticipantName===f.name&&a.posY<=b&&(a.endPosY>=b||!a.endPosY)&&g.push(a)});var h,i=g.length?SEQ.metrics.data.activationSideWidth:0,j=g.length?SEQ.entityActivation.calcActivationCenterDiff(g)+SEQ.metrics.data.activationSideWidth:0;h=c?SEQ.metrics.data.dragAndDropInteractionMargin:f.width/2;var k=SEQ.parser.diagram.title?SEQ.parser.diagram.title.totalHeight:0,l=k+SEQ.metrics.data.participantMarginTop+SEQ.parser.diagram.participantMaxHeight;if(a>f.posX-h-i&&a<f.posX+h+j&&(!b||b>l-f.height))return f}}function l(a){return r.PARTICIPANT===a}var m="((?:[^#<>\\-:\\,\\=\\s]+[^#<>\\,:]*[^#<>\\-:\\,\\=\\s]+)|(?:[^#<>\\-:\\,\\=\\s]+))",n="(?:\\s?(#[a-fA-F0-9]{6})|(?:\\s?#)([a-zA-Z]{3,20}))",o=n+"?",p=new RegExp('^\\s*(participant|actor|boundary|control|entity|database)\\s(?:(")(.+)(")\\s(as)\\s)?'+m+o),q={TYPE:1,QUOTE_1:2,LONG_NAME:3,QUOTE_2:4,AS:5,ALIAS:6,COLOR_HEX:7,COLOR_NAME:8},r={PARTICIPANT:"participant",ACTOR:"actor",BOUNDARY:"boundary",CONTROL:"control",ENTITY:"entity",DATABASE:"database"};return{parse:a,paint:h,findParticipantXCollision:k,storeParticipantWithDefinedWidths:c,storeParticipantWithTimelineWidths:b,storeParticipantsAndCalcWidths:f,updateParticipantRequiredEntityWidth:e,isType:l,Type:r,nameGroup:m,colorGroup:o,colorGroupMandatory:n,regExp:p,groups:q}}();var SEQ=SEQ||{};SEQ.entityDivider=function(){function a(a){var e=g.exec(a);if(null!=e&&e.length>h.TEXT){var f=SEQ.textUtil.parseTextData(e[h.TEXT]),j=e[h.COLOR_NAME],k=e[h.COLOR_HEX],l=j?j:k;return{type:i.DIVIDER,textData:f,color:l,totalHeight:f.height+2*SEQ.metrics.data.textPadding,totalWidth:f.width+2*SEQ.metrics.data.textPadding+2*SEQ.metrics.data.boxBleed,topMargin:SEQ.metrics.data.entityMarginTop,raw:a,paint:c,updatePos:b,collision:d}}}function b(a,b){a.posY=b}function c(a,b){function c(){return 1===a.textData.lines.length&&""===a.textData.lines[0]}var d=SEQ.parser.diagram.participants,e=d[0].posX,f=d[d.length-1].posX,g=Math.abs(e-f),h=e<f?e:f,i=SEQ.metrics.data.dividerLineSpacing,j=SEQ.metrics.data.dividerBleed,k=a.posY-a.totalHeight/2;if(b.beginPath(),b.moveTo(h-j,k-i),b.lineTo(h+g+j,k-i),b.moveTo(h-j,k),b.lineTo(h+g+j,k),b.moveTo(h-j,k+i),b.lineTo(h+g+j,k+i),b.stroke(),!c()){var l=a.posY-a.totalHeight,m=h+g/2-a.totalWidth/2;b.beginPath(),b.moveTo(m,l),b.lineTo(m+a.totalWidth,l),b.lineTo(m+a.totalWidth,l+a.totalHeight),b.lineTo(m,l+a.totalHeight),b.closePath();var n=b.fillStyle;a.color?b.fillStyle=a.color:b.fillStyle="white",b.fill(),b.fillStyle=n,b.stroke();var o=h+g/2-a.textData.width/2;SEQ.textUtil.fillText(b,a.textData.parsedLines,o,a.posY-a.totalHeight/2-a.textData.height/2)}}function d(a){var b,c,d=SEQ.parser.diagram.participants,e=d[0].posX,f=d[d.length-1].posX;e<f?(b=e,c=f):(b=e,c=f);var g=b-a.totalWidth/2,h=c+a.totalWidth/2,i=b-SEQ.metrics.data.dividerBleed,j=c+SEQ.metrics.data.dividerBleed;return b==c?(b=g<i?g:i,c=h>j?h:j):(b=i,c=j),{startX:b,endX:c,startY:a.posY,endY:a.posY-a.totalHeight}}function e(a){return i.DIVIDER+a.replace(/\n/g,"\\n")+i.DIVIDER}function f(a){return i.DIVIDER===a}var g=new RegExp("^\\s*(==)(.*)(==)"+SEQ.entityParticipant.colorGroup),h={EQUALS_1:1,TEXT:2,EQUALS_2:3,COLOR_HEX:4,COLOR_NAME:5},i={DIVIDER:"=="};return{parse:a,paint:c,collision:d,build:e,isType:f,Type:i,groups:h,regExp:g}}();var SEQ=SEQ||{};SEQ.entityTitle=function(){function a(a){var b=c.exec(a);if(null!=b&&b.length>d.VALUE)return{type:e.TITLE,title:b[d.VALUE],totalHeight:SEQ.metrics.data.textLineHeight*SEQ.main.fontSizeTitleRatio+SEQ.metrics.data.baseSpaceMetric,topMargin:0,font:SEQ.main.getFontTitle(),raw:a}}function b(a){var b=SEQ.parser.diagram,c=SEQ.main.getDiagramContext();c.font=b.title.font,c.fillStyle="black";var d=SEQ.metrics.calcWidth(b.title.title);c.fillText(b.title.title,a.width/2-d/2,b.title.topMargin+b.title.totalHeight-SEQ.metrics.data.baseSpaceMetric)}var c=new RegExp("^\\s*(title) (.+)","i"),d={TITLE:1,VALUE:2},e={TITLE:"title"};return{parse:a,paint:b,Type:e,regExp:c,groups:d}}();var SEQ=SEQ||{};SEQ.entityFontFamily=function(){function a(a){var d=b.exec(a);if(null!=d&&d.length>c.NAME){var e=d[c.NAME];return{raw:a,fontFamily:e}}}var b=new RegExp("^\\s*(fontfamily)\\s(.+)"),c={FONT_FAMILY:1,NAME:2},d={FONT_FAMILY:"fontfamily"};return{parse:a,regExp:b,groups:c,Type:d}}();var SEQ=SEQ||{};SEQ.entityMessage=function(){function a(a,j,k,m,o){var p=r.exec(a);if(null!=p&&p.length>t.TEXT){var q,s,u=p[t.TYPE];u.indexOf(">")>-1?(q=p[t.PARTICIPANT_1],s=p[t.PARTICIPANT_2]):(q=p[t.PARTICIPANT_2],s=p[t.PARTICIPANT_1]);var v,w=f([p[t.COLOR_HEX_3],p[t.COLOR_NAME_4],p[t.COLOR_HEX_5],p[t.COLOR_NAME_6],p[t.COLOR_HEX_7],p[t.COLOR_NAME_8]]),x=k?m:null,y=SEQ.textUtil.parseTextData(p[t.TEXT],x),z=y.height;if(q===s){v=y.width+SEQ.metrics.data.messageArrowWidth+SEQ.metrics.data.textPadding+SEQ.metrics.data.messageSelfRefSideMargin;var A=SEQ.metrics.data.messageSelfRefWidth,B=SEQ.metrics.data.messageSelfRefSideMargin;v=v>A+B?v:A+B,z+=SEQ.metrics.data.messageSelfRefHeight}else v=y.width+2*SEQ.metrics.data.messageArrowWidth+2*SEQ.metrics.data.textPadding;if(o)var C=g(z,u,q,s);return{type:u,fromParticipantName:q,toParticipantName:s,textData:y,color:w,totalHeight:z,totalWidth:v,topMargin:SEQ.metrics.data.entityMarginTop,autoNumber:x,parallel:j,linearRequiredHeight:C,linear:o,raw:a,message:!0,paint:i,updatePos:b,collision:l,buildRaw:n,calcPosX:h,updateActivationPosDiff:e,updateEnclosingFragments:d,updateParticipantWidths:c}}}function b(a,b,c,d){a.posY=b,a.fromPosX=c,a.toPosX=d}function c(a){if(a.fromParticipantName===a.toParticipantName)SEQ.entityParticipant.storeParticipantWithDefinedWidths(a.fromParticipantName,0,a.totalWidth);else{var b=SEQ.parser.diagram.participants.indexOf(SEQ.parser.diagram.participantsByName[a.fromParticipantName]),c=SEQ.parser.diagram.participants.indexOf(SEQ.parser.diagram.participantsByName[a.toParticipantName]);b<c?SEQ.entityParticipant.storeParticipantsAndCalcWidths(a.fromParticipantName,a.toParticipantName,a.totalWidth):SEQ.entityParticipant.storeParticipantsAndCalcWidths(a.fromParticipantName,a.toParticipantName,a.totalWidth)}}function d(a){if(a.fromParticipantName===a.toParticipantName)SEQ.entityFragment.storeEnclosedEntriesData(a.fromParticipantName,0,a.totalWidth,0,a.fromActivationXDiff);else{var b=SEQ.parser.diagram.participants.indexOf(SEQ.parser.diagram.participantsByName[a.fromParticipantName]),c=SEQ.parser.diagram.participants.indexOf(SEQ.parser.diagram.participantsByName[a.toParticipantName]);b<c?(SEQ.entityFragment.storeEnclosedEntriesData(a.fromParticipantName,0,0,0,0),SEQ.entityFragment.storeEnclosedEntriesData(a.toParticipantName,0,0,0,a.toActivationXDiff,0)):(SEQ.entityFragment.storeEnclosedEntriesData(a.fromParticipantName,0,0,0,0),SEQ.entityFragment.storeEnclosedEntriesData(a.toParticipantName,0,0,a.toActivationXDiff,0))}}function e(a,b){var c=SEQ.parser.diagram.ongoingActivations,d=SEQ.parser.diagram.participants.indexOf(SEQ.parser.diagram.participantsByName[a.fromParticipantName]),e=SEQ.parser.diagram.participants.indexOf(SEQ.parser.diagram.participantsByName[a.toParticipantName]),f=0,g=0,h=c[a.fromParticipantName]||[],i=c[a.toParticipantName]||[];a.fromParticipantName===a.toParticipantName?(h.length&&(f+=SEQ.entityActivation.calcActivationCenterDiff(h)+SEQ.metrics.data.activationSideWidth,g+=SEQ.entityActivation.calcActivationCenterDiff(i)+SEQ.metrics.data.activationSideWidth),"undefined"==typeof a.fromActivationXDiffOriginal&&(a.fromActivationXDiffOriginal=a.fromActivationXDiff)):d<e?(h.length&&(f+=SEQ.entityActivation.calcActivationCenterDiff(h)+SEQ.metrics.data.activationSideWidth),i.length&&(g+=SEQ.entityActivation.calcActivationCenterDiff(i)-SEQ.metrics.data.activationSideWidth)):(h.length&&(f+=SEQ.entityActivation.calcActivationCenterDiff(h)-SEQ.metrics.data.activationSideWidth),i.length&&(g+=SEQ.entityActivation.calcActivationCenterDiff(i)+SEQ.metrics.data.activationSideWidth)),b?(b.fromParticipantName===a.fromParticipantName&&(a.fromActivationXDiff=f),b.fromParticipantName===a.toParticipantName&&(a.toActivationXDiff=g)):(a.fromActivationXDiff=f,a.toActivationXDiff=g)}function f(a){for(var b=0;b<a.length;b++){var c=a[b];if(c)return c}}function g(a,b,c,d){var e,f,g=SEQ.parser.diagram;if(g.entries.length>0)for(var h=g.entries.length-1;h>=0;h--){var i=g.entries[h];if(i&&i.type){e=i,f=e.type.trim().replace(s,"");break}}var j=b.trim().replace(s,"");if(e&&q.exec(f)&&f===j&&e.toParticipantName===c&&c!=d){var k=g.participantsByName,l=g.participants,m=k[e.fromParticipantName],n=k[e.toParticipantName],o=k[c],p=k[d],r=l.indexOf(m),t=l.indexOf(n),u=l.indexOf(o),v=l.indexOf(p);if(r<t&&u<=v||r>t&&u>=v)return a<=e.totalHeight?0:a-e.totalHeight}return null}function h(a){var b=SEQ.parser.diagram.participantsByName[a.fromParticipantName].posX,c=SEQ.parser.diagram.participantsByName[a.toParticipantName].posX;return b+=a.fromParticipantName===a.toParticipantName?"undefined"==typeof a.fromActivationXDiffOriginal?a.fromActivationXDiff:a.fromActivationXDiffOriginal:a.fromActivationXDiff,c+=a.toActivationXDiff,{fromX:b,toX:c}}function i(a,b,c,d){var e,f;if(d)e=a.fromPosX,f=a.toPosX;else{var g=h(a);e=g.fromX,f=g.toX}var i,k,l=e>f?f:e,m=a.fromParticipantName===a.toParticipantName&&Math.abs(e-f)<SEQ.metrics.data.messageCreatorInteractionMargin+a.fromActivationXDiff;if(m)i=f+SEQ.metrics.data.messageArrowWidth+SEQ.metrics.data.textPadding,k=a.posY-a.totalHeight,SEQ.textUtil.fillText(b,a.textData.parsedLines,i,k,a.autoNumber,a.textData.autoNumberWidth,!0);else{var n=Math.abs(e-f);i=l+n/2-a.textData.width/2,k=a.posY-a.totalHeight,SEQ.textUtil.fillText(b,a.textData.parsedLines,i,k,a.autoNumber,a.textData.autoNumberWidth,!0)}c?j(b,a.type,a.posY,e,f,m):j(b,a.type,a.posY,e,f,m,a.color)}function j(a,b,c,d,e,f,g){if(a.save(),g&&(a.strokeStyle=g,a.fillStyle=g),a.beginPath(),b.indexOf("--")>-1&&void 0!==a.setLineDash&&a.setLineDash([SEQ.metrics.data.messageLineDashWidth]),f){var h=SEQ.metrics.data.messageSelfRefHeight,i=SEQ.metrics.data.messageSelfRefWidth+Math.abs(d-e);a.moveTo(d,c-h),a.lineTo(d+i,c-h),a.lineTo(d+i,c),a.lineTo(e,c),a.stroke(),d+=1}else a.moveTo(d,c),a.lineTo(e,c),a.stroke();var j=b.indexOf(">>")>-1||b.indexOf("<<")>-1,l=d<e&&!f;k(c,l,e,a,j),b.indexOf(">")>-1&&b.indexOf("<")>-1&&k(c,e<d,d,a,j),a.restore()}function k(a,b,c,d,e){var f,g=SEQ.metrics.data.messageArrowWidth;f=b?-g:g,d.beginPath(),d.moveTo(c+f,a-g/2),d.lineTo(c,a),d.lineTo(c+f,a+g/2),e?d.stroke():(d.closePath(),d.fill())}function l(a){var b,c,d=h(a),e=d.fromX,f=d.toX;return a.fromParticipantName===a.toParticipantName?(b=e,c=f+a.totalWidth-SEQ.metrics.data.messageSelfRefSideMargin):e<f?(b=e,c=f):(b=f,c=e),{startX:b+SEQ.metrics.data.messageInteractionMargin,endX:c-SEQ.metrics.data.messageInteractionMargin,startY:a.posY+SEQ.metrics.data.collisionBleed,endY:a.posY-a.totalHeight}}function m(a,b,c,d){return/>/.exec(a)?b+a+c+":"+d.replace(/\n/g,"\\n"):c+a+b+":"+d.replace(/\n/g,"\\n")}function n(a){return/>/.exec(a.type)?a.fromParticipantName+a.type+a.toParticipantName+":"+SEQ.textUtil.buildSourceText(a.textData):a.toParticipantName+a.type+a.fromParticipantName+":"+SEQ.textUtil.buildSourceText(a.textData)}function o(a){return null!=q.exec(a)}var p="(\\s*--?"+SEQ.entityParticipant.colorGroup+">?>\\s*|\\s*<<?"+SEQ.entityParticipant.colorGroup+"-?-\\s*|\\s*<<?-?-"+SEQ.entityParticipant.colorGroup+">?>\\s*)",q=new RegExp(p),r=new RegExp("^\\s*"+SEQ.entityParticipant.nameGroup+p+SEQ.entityParticipant.nameGroup+"\\s?:\\s?(.*)"),s=new RegExp(SEQ.entityParticipant.colorGroupMandatory),t={PARTICIPANT_1:1,TYPE:2,COLOR_HEX_3:3,COLOR_NAME_4:4,COLOR_HEX_5:5,COLOR_NAME_6:6,COLOR_HEX_7:7,COLOR_NAME_8:8,PARTICIPANT_2:9,TEXT:10},u={REQ_FORWARD_SYNC:"->",RESP_FORWARD_SYNC:"-->",REQ_FORWARD_ASYNC:"->>",RESP_FORWARD_ASYNC:"-->>",REQ_BACKWARD_SYNC:"<-",RESP_BACKWARD_SYNC:"<--",REQ_BACKWARD_ASYNC:"<<-",RESP_BACKWARD_ASYNC:"<<--"};return{parse:a,paint:i,collision:l,build:m,paintArrowHead:k,isType:o,Type:u,regExpArrow:q,regExp:r,groups:t}}();var SEQ=SEQ||{};SEQ.entityNoteBoxLeftRight=function(){function a(a,i){var k=l.exec(a);if(null!=k&&k.length>m.TEXT){var n=SEQ.textUtil.parseTextData(k[m.TEXT]),o=k[m.TYPE],p=k[m.PARTICIPANT_FROM],q=k[m.COLOR_NAME],r=k[m.COLOR_HEX],s=q?q:r,t=n.width+2*SEQ.metrics.data.textPadding+2*SEQ.metrics.data.boxBleed+2*SEQ.metrics.data.entryMarginSide,u=k[m.SIDE];return{type:o,fromParticipantName:p,side:u,textData:n,color:s,parallel:i,totalHeight:n.height+2*SEQ.metrics.data.textPadding,
totalWidth:t,topMargin:SEQ.metrics.data.entityMarginTop,raw:a,paint:g,updatePos:b,collision:h,buildRaw:j,calcPosX:f,updateActivationPosDiff:e,updateEnclosingFragments:d,updateParticipantWidths:c}}}function b(a,b,c){a.posY=b,a.fromPosX=c}function c(a){o.LEFT===a.side?SEQ.entityParticipant.storeParticipantWithDefinedWidths(a.fromParticipantName,a.totalWidth,0):SEQ.entityParticipant.storeParticipantWithDefinedWidths(a.fromParticipantName,0,a.totalWidth)}function d(a){o.LEFT===a.side?SEQ.entityFragment.storeEnclosedEntriesData(a.fromParticipantName,a.totalWidth,0,Math.abs(a.fromActivationXDiff),0):SEQ.entityFragment.storeEnclosedEntriesData(a.fromParticipantName,0,a.totalWidth,0,a.fromActivationXDiff)}function e(a){var b=SEQ.parser.diagram.ongoingActivations,c=0,d=b[a.fromParticipantName]||[];a.side===SEQ.entityNoteBoxLeftRight.NotePosition.LEFT&&d.length?c-=SEQ.metrics.data.activationSideWidth:a.side===SEQ.entityNoteBoxLeftRight.NotePosition.RIGHT&&d.length&&(c+=SEQ.entityActivation.calcActivationCenterDiff(d)+SEQ.metrics.data.activationSideWidth),a.fromActivationXDiff=c}function f(a){var b=SEQ.parser.diagram.participantsByName[a.fromParticipantName].posX;return b+=a.fromActivationXDiff,{fromX:b}}function g(a,b,c,d){var e;if(d)e=a.fromPosX;else{var g=f(a);e=g.fromX}b.beginPath();var h,i=SEQ.metrics.data.entryMarginSide;a.side===SEQ.entityNoteBoxLeftRight.NotePosition.LEFT?(h=e-a.totalWidth+i,b.moveTo(e,a.posY-a.totalHeight/2),b.lineTo(e-i,a.posY-a.totalHeight/2)):a.side===SEQ.entityNoteBoxLeftRight.NotePosition.RIGHT&&(h=e+i,b.moveTo(e,a.posY-a.totalHeight/2),b.lineTo(e+i,a.posY-a.totalHeight/2)),SEQ.entityNoteBoxOver.paintNoteOrBox(a,b,h,a.totalWidth-2*i);var j=h-i+a.totalWidth/2-a.textData.width/2,k=a.posY-a.totalHeight/2-a.textData.height/2;SEQ.textUtil.fillText(b,a.textData.parsedLines,j,k)}function h(a){var b,c,d=f(a),e=d.fromX,g=SEQ.metrics.data.entryMarginSide;return a.side===SEQ.entityNoteBoxLeftRight.NotePosition.LEFT?(b=e-a.totalWidth,c=e):a.side===SEQ.entityNoteBoxLeftRight.NotePosition.RIGHT&&(b=e,c=e+a.totalWidth),b+=g,c-=g,{startX:b,endX:c,startY:a.posY,endY:a.posY-a.totalHeight}}function i(a,b,c,d){return a+" "+b+" "+c+":"+d.replace(/\n/g,"\\n")}function j(a){var b="";return a.color&&(b=a.color.indexOf("#")>-1?" "+a.color:" #"+a.color),a.type+" "+a.side+" "+a.fromParticipantName+b+":"+SEQ.textUtil.buildSourceText(a.textData)}function k(a){return n.NOTE===a||n.BOX===a||n.ABOX===a||n.RBOX===a}var l=new RegExp("^\\s*(note|box|rbox|abox)\\s(left\\sof|right\\sof)\\s"+SEQ.entityParticipant.nameGroup+"\\s?"+SEQ.entityParticipant.colorGroup+"\\s?:\\s?(.*)"),m={TYPE:1,SIDE:2,PARTICIPANT_FROM:3,COLOR_HEX:4,COLOR_NAME:5,TEXT:6},n={NOTE:"note",BOX:"box",RBOX:"rbox",ABOX:"abox"},o={LEFT:"left of",RIGHT:"right of"};return{parse:a,paint:g,collision:h,build:i,regExp:l,Type:n,isType:k,NotePosition:o,groups:m}}();var SEQ=SEQ||{};SEQ.entityNoteBoxOver=function(){function a(a,g){var h=o.exec(a);if(null!=h&&h.length>p.TEXT){var i,j=SEQ.textUtil.parseTextData(h[p.TEXT]),k=h[p.TYPE],m=h[p.PARTICIPANT_TO],q=h[p.PARTICIPANT_FROM],s=h[p.COLOR_NAME],t=h[p.COLOR_HEX],u=s?s:t;return i=m?j.width+2*SEQ.metrics.data.textPadding:j.width+2*SEQ.metrics.data.textPadding+2*SEQ.metrics.data.boxBleed+2*SEQ.metrics.data.entryMarginSide,{type:k,notePosition:r.OVER,fromParticipantName:q,toParticipantName:m,side:h[p.SIDE],textData:j,color:u,parallel:g,totalHeight:j.height+2*SEQ.metrics.data.textPadding,totalWidth:i,topMargin:SEQ.metrics.data.entityMarginTop,raw:a,paint:f,updatePos:b,collision:l,buildRaw:n,calcPosX:e,updateEnclosingFragments:d,updateParticipantWidths:c}}}function b(a,b,c,d){a.posY=b,a.fromPosX=c,a.toPosX=d}function c(a){if(a.toParticipantName)SEQ.entityParticipant.storeParticipantsAndCalcWidths(a.fromParticipantName,a.toParticipantName,a.totalWidth);else{var b=a.totalWidth/2;SEQ.entityParticipant.storeParticipantWithDefinedWidths(a.fromParticipantName,b,b)}}function d(a){if(a.toParticipantName)SEQ.entityFragment.storeEnclosedEntriesData(a.fromParticipantName,0,0,0,0),SEQ.entityFragment.storeEnclosedEntriesData(a.toParticipantName,0,0,0,0);else{var b=a.totalWidth/2;SEQ.entityFragment.storeEnclosedEntriesData(a.fromParticipantName,b,b,0,0)}}function e(a){var b=SEQ.parser.diagram.participantsByName[a.fromParticipantName].posX,c=null;return a.toParticipantName&&(c=SEQ.parser.diagram.participantsByName[a.toParticipantName].posX),{fromX:b,toX:c}}function f(a,b,c,d){var f,h;if(d)f=a.fromPosX,a.toParticipantName&&(h=a.toPosX);else{var i=e(a);f=i.fromX,h=i.toX}b.beginPath();var j,k,l,m,n=SEQ.metrics.data.boxBleed;if(h){var o=h>f?f:h;j=o-n,m=Math.abs(f-h)+2*n,k=j+m/2-a.textData.width/2,l=a.posY-a.totalHeight/2-a.textData.height/2}else j=f-a.totalWidth/2+SEQ.metrics.data.entryMarginSide,m=a.totalWidth-2*SEQ.metrics.data.entryMarginSide,k=f-a.textData.width/2,l=a.posY-a.totalHeight/2-a.textData.height/2;g(a,b,j,m),SEQ.textUtil.fillText(b,a.textData.parsedLines,k,l)}function g(a,b,c,d){q.NOTE==a.type?h(b,c,a.posY,a.totalHeight,d,a.color):q.BOX==a.type?i(b,c,a.posY,a.totalHeight,d,a.color):q.RBOX==a.type?j(b,c,a.posY,a.totalHeight,d,a.color):q.ABOX==a.type&&k(b,c,a.posY,a.totalHeight,d,a.color)}function h(a,b,c,d,e,f){var g=SEQ.metrics.data.boxBleed;a.moveTo(b,c-d),a.lineTo(b+e-g,c-d),a.lineTo(b+e,c-d+g),a.lineTo(b+e,c),a.lineTo(b,c),a.lineTo(b,c-d);var h=a.fillStyle;f?a.fillStyle=f:a.fillStyle="white",a.fill(),a.moveTo(b+e-g,c-d),a.lineTo(b+e-g,c-d+g),a.lineTo(b+e,c-d+g),a.fillStyle=h,a.stroke()}function i(a,b,c,d,e,f){a.moveTo(b,c-d),a.lineTo(b+e,c-d),a.lineTo(b+e,c),a.lineTo(b,c),a.lineTo(b,c-d);var g=a.fillStyle;f?a.fillStyle=f:a.fillStyle="white",a.fill(),a.fillStyle=g,a.stroke()}function j(a,b,c,d,e,f){var g=SEQ.metrics.data.boxBleed;a.moveTo(b,c-d+g),a.arc(b+g,c-d+g,g,Math.PI,-Math.PI/2),a.lineTo(b+e-g,c-d),a.arc(b+e-g,c-d+g,g,-Math.PI/2,0),a.lineTo(b+e,c-g),a.arc(b+e-g,c-g,g,0,Math.PI/2),a.lineTo(b+g,c),a.arc(b+g,c-g,g,Math.PI/2,Math.PI),a.lineTo(b,c-d+g);var h=a.fillStyle;f?a.fillStyle=f:a.fillStyle="white",a.fill(),a.fillStyle=h,a.stroke()}function k(a,b,c,d,e,f){var g=SEQ.metrics.data.boxBleed;a.moveTo(b+g,c-d),a.lineTo(b+e-g,c-d),a.lineTo(b+e,c-d/2),a.lineTo(b+e-g,c),a.lineTo(b+g,c),a.lineTo(b,c-d/2),a.lineTo(b+g,c-d);var h=a.fillStyle;f?a.fillStyle=f:a.fillStyle="white",a.fill(),a.fillStyle=h,a.stroke()}function l(a){var b,c,d=e(a),f=d.fromX,g=d.toX;return g?(f<g?(b=f,c=g):(b=g,c=f),b-=SEQ.metrics.data.boxBleed+SEQ.metrics.data.noteOverCollisionLineCompensation,c+=SEQ.metrics.data.boxBleed+SEQ.metrics.data.noteOverCollisionLineCompensation):(b=f-a.totalWidth/2+SEQ.metrics.data.entryMarginSide,c=f+a.totalWidth/2-SEQ.metrics.data.entryMarginSide),{startX:b,endX:c,startY:a.posY,endY:a.posY-a.totalHeight}}function m(a,b,c){return a+" "+r.OVER+" "+b+":"+c.replace(/\n/g,"\\n")}function n(a){var b="";a.color&&(b=a.color.indexOf("#")>-1?" "+a.color:" #"+a.color);var c=a.toParticipantName?","+a.toParticipantName:"";return a.type+" "+a.side+" "+a.fromParticipantName+c+b+":"+SEQ.textUtil.buildSourceText(a.textData)}var o=new RegExp("^\\s*(note|box|rbox|abox)\\s(over)\\s"+SEQ.entityParticipant.nameGroup+",?\\s?"+SEQ.entityParticipant.nameGroup+"?\\s?"+SEQ.entityParticipant.colorGroup+"\\s?:\\s?(.*)"),p={TYPE:1,SIDE:2,PARTICIPANT_FROM:3,PARTICIPANT_TO:4,COLOR_HEX:5,COLOR_NAME:6,TEXT:7},q={NOTE:"note",BOX:"box",RBOX:"rbox",ABOX:"abox"},r={OVER:"over"};return{parse:a,paint:f,collision:l,build:m,paintNoteOrBox:g,Type:q,NotePosition:r,regExp:o,groups:p}}();var SEQ=SEQ||{};SEQ.entityAutoNumber=function(){function a(a){var d=b.exec(a);if(null!=d&&d.length>c.STATUS){var e,f=d[c.STATUS];if("on"===f)var g=!0;else"off"===f?g=!1:isNaN(f)?g=!0:(g=!0,e=f);return{raw:a,enabled:g,value:e}}}var b=new RegExp("^\\s*(autonumber)\\s?(on|off|[0-9]+)?"),c={AUTO_NUMBER:1,STATUS:2},d={AUTO_NUMBER:"autonumber"};return{parse:a,regExp:b,groups:c,Type:d}}();var SEQ=SEQ||{};SEQ.entityLinear=function(){function a(a){var d=b.exec(a);if(null!=d&&d.length>c.STATUS){var e=d[c.STATUS];if("on"===e)var f=!0;else f="off"!==e&&"end"!==e;return{raw:a,enabled:f}}}var b=new RegExp("^\\s*(linear)\\s?(on|off|end)?"),c={LINEAR:1,STATUS:2},d={LINEAR:"linear"};return{parse:a,regExp:b,groups:c,Type:d}}();var SEQ=SEQ||{};SEQ.entityFragment=function(){function a(a,b){var c=SEQ.parser.diagram.ongoingFragments,d=l.exec(a);if(null!=d&&d.length>m.OPERATOR){var e=d[m.TEXT],g=d[m.OPERATOR];if(n.END!==g){if(n.ELSE===g){for(var i=!1,j=c.length-1;j>=0;j--){var k=c[j];if(k.type==n.ALT){var o={posY:b+SEQ.metrics.data.participantMarginTop+SEQ.parser.diagram.participantMaxHeight+SEQ.metrics.data.entityMarginTop+SEQ.metrics.data.fragmentHeight,totalHeight:SEQ.metrics.data.fragmentHeight,text:e};k.elseGuards.push(o),i=!0;break}}return i?{type:g,fragment:k,elseGuard:o,totalHeight:SEQ.metrics.data.fragmentHeight,topMargin:SEQ.metrics.data.entityMarginTop,raw:a,paint:f,updatePos:function(a,b){a.elseGuard.posY=b},collision:h}:{raw:a}}for(var p={type:g,text:e,font:"bold "+SEQ.main.getFontSmall(),enclosedEntitiesData:[],subFragments:[],elseGuards:[],leftWidth:0,rightWidth:0,topMargin:SEQ.metrics.data.entityMarginTop,posY:b+SEQ.metrics.data.participantMarginTop+SEQ.parser.diagram.participantMaxHeight+SEQ.metrics.data.entityMarginTop+SEQ.metrics.data.fragmentHeight,totalHeight:SEQ.metrics.data.fragmentHeight,typeWidth:SEQ.metrics.calcWidth(g),raw:a},q=0;q<c.length;q++){var r=c[q];r.subFragments.push(p)}return c.push(p),{type:g,fragment:p,totalHeight:p.totalHeight,topMargin:p.topMargin,raw:a,paint:f,updatePos:function(a,b){a.fragment.posY=b},collision:h}}if(c.length>0){var s=c.pop();return s.endPosY=b+SEQ.metrics.data.participantMarginTop+SEQ.parser.diagram.participantMaxHeight,SEQ.parser.diagram.fragments.push(s),{type:g,fragment:s,totalHeight:0,topMargin:SEQ.metrics.data.entityMarginTop,raw:a,paint:f,updatePos:function(a,b){a.fragment.endPosY=b-a.fragment.topMargin},collision:h}}}}function b(a,b,c,d,e){function f(a){for(var b=0;b<i.enclosedEntitiesData.length;b++){var c=i.enclosedEntitiesData[b];if(a==c.participantName)return c}}for(var g=SEQ.parser.diagram.ongoingFragments,h=0;h<g.length;h++){var i=g[h],j=f(a);j?(b>j.entityLeftWidth&&(j.entityLeftWidth=b),c>j.entityRightWidth&&(j.entityRightWidth=c),d>j.timelineLeftWidth&&(j.timelineLeftWidth=d),e>j.timelineRightWidth&&(j.timelineRightWidth=e)):i.enclosedEntitiesData.push({participantName:a,entityLeftWidth:b,entityRightWidth:c,timelineLeftWidth:d,timelineRightWidth:e})}}function c(){for(var a=e(),b=SEQ.parser.diagram.fragments,c=0;c<b.length;c++){for(var f=b[c],g=Number.POSITIVE_INFINITY,h=Number.NEGATIVE_INFINITY,i=null,j=null,k=0;k<f.enclosedEntitiesData.length;k++){var l=f.enclosedEntitiesData[k],m=a[l.participantName];m<g&&(g=m,i=l),m>h&&(h=m,j=l)}if(!i){var n=SEQ.parser.diagram.participants[0];i={participantName:n.name,entityLeftWidth:n.entityLeftWidth,entityRightWidth:n.entityRightWidth,timelineLeftWidth:n.timelineLeftWidth,timelineRightWidth:n.timelineRightWidth}}if(!j){var o=SEQ.parser.diagram.participants[SEQ.parser.diagram.participants.length-1];j={participantName:o.name,entityLeftWidth:o.entityLeftWidth,entityRightWidth:o.entityRightWidth,timelineLeftWidth:n.timelineLeftWidth,timelineRightWidth:n.timelineRightWidth}}f.participantDataMin=i,f.participantDataMax=j;var p=d(f.subFragments,i,j),q=SEQ.metrics.data.fragmentBleed,r=Math.max(q,i.entityLeftWidth);p.leftWidth>r&&(r=p.leftWidth);var s=Math.max(q,j.entityRightWidth);p.rightWidth>s&&(s=p.rightWidth),f.leftWidth=r,f.rightWidth=s;var t=SEQ.parser.diagram.participantsByName[i.participantName],u=SEQ.parser.diagram.participantsByName[j.participantName];SEQ.entityParticipant.updateParticipantRequiredEntityWidth(t,r+SEQ.metrics.data.fragmentMarginSide,0),SEQ.entityParticipant.updateParticipantRequiredEntityWidth(u,0,s+SEQ.metrics.data.fragmentMarginSide)}}function d(a,b,c){for(var d=0,e=0,f=0;f<a.length;f++){var g=a[f];g.participantDataMin.participantName==b.participantName&&g.leftWidth>d&&(d=g.leftWidth),g.participantDataMax.participantName==c.participantName&&g.rightWidth>e&&(e=g.rightWidth)}return{leftWidth:d+SEQ.metrics.data.fragmentMarginSide,rightWidth:e+SEQ.metrics.data.fragmentMarginSide}}function e(){for(var a=SEQ.parser.diagram.participants,b=[],c=0;c<a.length;c++)b[a[c].name]=c;return b}function f(a,b,c,d){function e(a){b.save(),b.setLineDash([SEQ.metrics.data.fragmentElseLineDashWidth]),b.beginPath(),b.moveTo(j,a.posY-a.totalHeight),b.lineTo(k,a.posY-a.totalHeight),b.stroke(),b.restore(),a.text&&b.fillText("["+a.text+"]",m+SEQ.metrics.data.fragmentTextSideMargin,a.posY-SEQ.metrics.data.fragmentTextPosYOffset)}function f(){b.beginPath(),b.moveTo(j,l+g.totalHeight),b.lineTo(j+2*SEQ.metrics.data.fragmentLabelSidePadding+g.typeWidth,l+g.totalHeight),b.lineTo(m,l+SEQ.metrics.data.fragmentLabelSmallHeight),b.lineTo(m,l);var a=b.fillStyle;b.fillStyle="white",b.lineTo(j,l),b.fill(),b.stroke(),b.beginPath(),b.rect(j,l,k-j,g.endPosY-l+g.topMargin),b.stroke(),b.fillStyle=a,b.fillText(g.type,j+SEQ.metrics.data.fragmentLabelSidePadding,l+g.totalHeight-SEQ.metrics.data.fragmentTextPosYOffset),g.text&&b.fillText("["+g.text+"]",m+SEQ.metrics.data.fragmentTextSideMargin,l+g.totalHeight-SEQ.metrics.data.fragmentTextPosYOffset)}var g=a.fragment;if(a.type!=n.END&&g.endPosY||c||d){var h=i(g),j=h.minX,k=h.maxX,l=g.posY-g.totalHeight;b.save(),b.lineWidth=SEQ.metrics.data.fragmentLineWeight,b.font=g.font;var m=j+2*SEQ.metrics.data.fragmentLabelSidePadding+g.typeWidth+SEQ.metrics.data.fragmentLabelEdgeLength;n.ELSE==a.type?(c||d)&&e(a.elseGuard):(f(),g.elseGuards.forEach(function(a){e(a)})),b.restore()}}function g(a){for(var b=SEQ.parser.diagram.fragments,c=0;c<b.length;c++){var d=b[c];if(n.ALT==d.type){var e=i(d);if(a.y>d.posY-d.totalHeight&&a.y<d.endPosY+d.topMargin&&a.x>e.minX&&a.x<e.maxX)return!0}}}function h(a){var b=a.fragment;if(!b.participantDataMin||!b.participantDataMax)return{startX:0,endX:0,startY:0,endY:0};var c=i(b);return{startX:c.minX,endX:c.maxX,startY:a.posY+SEQ.metrics.data.collisionBleed/2,endY:a.posY-a.totalHeight-SEQ.metrics.data.collisionBleed}}function i(a){var b=SEQ.parser.diagram.participantsByName,c=b[a.participantDataMin.participantName],d=c.posX-a.leftWidth-a.participantDataMin.timelineLeftWidth,e=b[a.participantDataMax.participantName],f=e.posX+a.rightWidth+a.participantDataMax.timelineRightWidth;return{minX:d,maxX:f}}function j(a,b){var c=a+" "+b;return n.ELSE!=a&&(c+="\nend"),c}function k(a){return null!=l.exec(a)}var l=new RegExp("^\\s*(alt|else|opt|loop|par|break|critical|ref|seq|strict|neg|ignore|consider|assert|region|end)(?:$|\\s(.*))"),m={OPERATOR:1,TEXT:2},n={ALT:"alt",ELSE:"else",OPT:"opt",LOOP:"loop",PAR:"par",BREAK:"break",CRITICAL:"critical",REF:"ref",SEQ:"seq",STRICT:"strict",NEG:"neg",IGNORE:"ignore",CONSIDER:"consider",ASSERT:"assert",END:"end"};return{parse:a,paint:f,regExp:l,build:j,storeEnclosedEntriesData:b,updateParticipantWidths:c,collision:h,insideAlt:g,isType:k,Type:n,groups:m}}();var SEQ=SEQ||{};SEQ.entityEntrySpacing=function(){function a(a){var b=c.exec(a);if(null!=b&&b.length>d.SPACING){var e=b[d.SPACING];return{raw:a,entrySpacing:parseFloat(e)}}}function b(a){return a<0&&(a=0),"entryspacing "+a.toFixed(1)}var c=new RegExp("^\\s*(entryspacing)\\s?([0-9]+(?:\\.[0-9]+)?$)"),d={ENTRY_SPACING:1,SPACING:2},e={ENTRY_SPACING:"entryspacing"};return{parse:a,build:b,regExp:c,groups:d,Type:e}}();var SEQ=SEQ||{};SEQ.entityParticipantSpacing=function(){function a(a){var b=c.exec(a);if(null!=b&&b.length>d.SPACING){var e=b[d.SPACING];return{raw:a,participantSpacing:e}}}var b="equal",c=new RegExp("^\\s*(participantspacing)\\s?([0-9]+(?:\\.[0-9]+)?|"+b+")$"),d={PARTICIPANT_SPACING:1,SPACING:2},e={PARTICIPANT_SPACING:"participantspacing"};return{parse:a,equal:b,regExp:c,groups:d,Type:e}}();var SEQ=SEQ||{};SEQ.entityFontSize=function(){function a(a){var d=b.exec(a);if(null!=d&&d.length>c.SIZE){var e=d[c.SIZE];return{raw:a,fontSize:e}}}var b=new RegExp("^\\s*(fontsize)\\s?([0-9]+)"),c={FONT_SIZE:1,SIZE:2},d={FONT_SIZE:"fontsize"};return{parse:a,regExp:b,groups:c,Type:d}}();var SEQ=SEQ||{};SEQ.entityParallel=function(){function a(a){var d=b.exec(a);if(null!=d&&d.length>c.STATUS){var e=d[c.STATUS];if("on"===e)var f=!0;else f="off"!==e&&"end"!==e;return{raw:a,enabled:f}}}var b=new RegExp("^\\s*(parallel)\\s?(on|off|end)?"),c={PARALLEL:1,STATUS:2},d={PARALLEL:"parallel"};return{parse:a,regExp:b,groups:c,Type:d}}();var SEQ=SEQ||{};SEQ.entityActivation=function(){function a(a){var c=g.exec(a);if(null!=c&&c.length>h.PARTICIPANT){var f=c[h.TYPE],j=c[h.PARTICIPANT],k=c[h.COLOR_NAME],l=c[h.COLOR_HEX],m=k?k:l,n=SEQ.parser.diagram.ongoingActivations[j];if(f.indexOf(i.DEACTIVATE)>-1){if(n&&n.length){var o=n.pop();return o.endPosY=SEQ.parser.diagram.entries[SEQ.parser.diagram.entries.length-1].posY,i.DEACTIVATE_AFTER===f&&(o.endPosY+=SEQ.metrics.data.activationAfterHeight),{raw:a}}}else if(f.indexOf(i.ACTIVATE)>-1){n||(SEQ.parser.diagram.ongoingActivations[j]=[],n=SEQ.parser.diagram.ongoingActivations[j]);var p={type:f,fromParticipantName:j,centerDiff:d(j),totalHeight:0,totalWidth:0,topMargin:0,color:m,activation:!0,raw:a,paint:b};return n.push(p),SEQ.entityParticipant.storeParticipantWithTimelineWidths(j,SEQ.metrics.data.activationSideWidth,e(n)+SEQ.metrics.data.activationSideWidth),p}}}function b(a,b){var c,d=SEQ.parser.diagram.participantsByName,e=d[a.fromParticipantName].posX+a.centerDiff;c=a.endPosY?a.endPosY:SEQ.parser.diagram.entries[SEQ.parser.diagram.entries.length-1].posY+SEQ.metrics.data.diagramMarginBottom-SEQ.metrics.data.baseSpaceMetric;var f=SEQ.metrics.data.activationSideWidth,g=a.posY;b.beginPath(),b.moveTo(e-f,g),b.lineTo(e+f,g),b.lineTo(e+f,c),b.lineTo(e-f,c),b.lineTo(e-f,g);var h=b.fillStyle;a.color?b.fillStyle=a.color:b.fillStyle="white",b.fill(),b.stroke(),b.fillStyle=h}function c(a,b){return a+" "+b}function d(a){var b=SEQ.parser.diagram.ongoingActivations[a];return b?0===b.length?0:b.length>=1?b.length*SEQ.metrics.data.activationSideWidth:void 0:0}function e(a){return a.length<=1?0:(a.length-1)*SEQ.metrics.data.activationSideWidth}function f(a){return i.ACTIVATE===a||i.DEACTIVATE===a||i.DEACTIVATE_AFTER===a}var g=new RegExp("^\\s*(activate|deactivate|deactivateafter)\\s"+SEQ.entityParticipant.nameGroup+"\\s?"+SEQ.entityParticipant.colorGroup),h={TYPE:1,PARTICIPANT:2,COLOR_NAME:3,COLOR_HEX:4},i={ACTIVATE:"activate",DEACTIVATE:"deactivate",DEACTIVATE_AFTER:"deactivateafter"};return{parse:a,paint:b,build:c,calcActivationCenterDiff:e,isType:f,Type:i,regExp:g,groups:h}}();var SEQ=SEQ||{};SEQ.entitySpace=function(){function a(a){var e=g.exec(a);if(null!=e&&e.length>=h.VALUE){var f=e[h.VALUE];return f||(f=1),{type:i.SPACE,totalHeight:SEQ.metrics.data.textLineHeight*f,topMargin:SEQ.metrics.data.entityMarginTop,paint:c,collision:d,updatePos:b,raw:a}}}function b(a,b){a.posY=b}function c(a,b,c,e){if(c||e){var f=d(a);b.beginPath(),b.moveTo(f.startX,f.endY),b.lineTo(f.endX,f.endY),b.lineTo(f.endX,f.startY),b.lineTo(f.startX,f.startY),b.lineTo(f.startX,f.endY),b.fill()}}function d(a){var b=SEQ.parser.diagram.participants,c=b[b.length-1],d=SEQ.metrics.data.entryMarginSide,e=c.width>c.entityRightWidth-SEQ.metrics.data.entryMarginSide?c.width/2:c.entityRightWidth-SEQ.metrics.data.entryMarginSide,f=c.posX+c.timelineRightWidth+e;return{startX:d,endX:f,startY:a.posY,endY:a.posY-a.totalHeight}}function e(a){return a}function f(a){return i.SPACE===a}var g=new RegExp("^\\s*(space)\\s?([0-9]+(?:\\.[0-9]+)?)?$"),h={SPACE:1,VALUE:2},i={SPACE:"space"};return{parse:a,build:e,isType:f,Type:i,regExp:g,groups:h}}();var SEQ=SEQ||{};SEQ.painter=function(){function a(){var a=SEQ.parser.diagram,g=f();e(g);var h=SEQ.main.getDiagramContext();h.save(),h.fillStyle="white";var i=SEQ.main.getDiagramCanvas();if(h.fillRect(0,0,i.width,i.height),h.restore(),a.title&&(h.save(),SEQ.entityTitle.paint(g),h.restore()),a.participants.length>0){h.save(),d(g,h),h.restore(),h.save(),b(),h.restore(),h.save(),c(),h.restore();var j=SEQ.main.getParticipantContext();a.participants.forEach(function(a){SEQ.entityParticipant.paint(a,j,!0)})}}function b(){var a=SEQ.parser.diagram,b=SEQ.main.getDiagramContext();a.participants.forEach(function(a){SEQ.entityParticipant.paint(a,b)})}function c(){var a=SEQ.parser.diagram,b=SEQ.main.getDiagramContext(),c=[],d=[],e=[];a.entries.forEach(function(a){a.paint&&(a.fragment?e.push(a):a.activation?c.push(a):d.push(a))}),c.forEach(function(a){a.paint(a,b)}),d.forEach(function(a){a.paint(a,b)}),e.forEach(function(a){a.paint(a,b)})}function d(a,b,c){var d=SEQ.parser.diagram,e=a.height,f=SEQ.metrics.data;d.participants.forEach(function(a){void 0!==b.setLineDash&&b.setLineDash([SEQ.metrics.data.diagramLineDashWidth,SEQ.metrics.data.diagramLineSpaceWidth]);var g=f.participantMarginTop+d.participantMaxHeight;d.title&&!c&&(g+=SEQ.parser.diagram.title.totalHeight),b.beginPath(),b.moveTo(a.posX,g),b.lineTo(a.posX,e),b.stroke()})}function e(a){var b=a.width,c=a.height,d=a.heightParticipant,e=SEQ.main.getDiagramCanvas(),f=SEQ.main.getInteractionCanvas(),g=SEQ.main.getParticipantCanvas();e.width=b,e.height=c,f.width=b,f.height=c,g.width=b,g.height=d;var h=SEQ.main.getDiagramContext();h.font=SEQ.main.getFontNormal(),h.lineWidth=SEQ.metrics.data.diagramLineWeight,h.fillStyle="black",h.strokeStyle="black";var i=SEQ.main.getInteractionContext();i.font=SEQ.main.getFontNormal(),i.lineWidth=SEQ.metrics.data.diagramLineWeight;var j=SEQ.main.getParticipantContext();j.font=SEQ.main.getFontNormal(),j.lineWidth=SEQ.metrics.data.diagramLineWeight,j.fillStyle="black",j.strokeStyle="black"}function f(){var a={width:0,height:0,heightParticipant:0},b=SEQ.parser.diagram;if(b.participants.length>0){var c=b.entries[b.entries.length-1].posY;0===c&&(c=SEQ.parser.diagram.participantMaxHeight+SEQ.metrics.data.participantMarginTop),a.height=c+SEQ.metrics.data.diagramMarginBottom;var d=b.participants[b.participants.length-1],e=Math.max(d.width/2+SEQ.metrics.data.participantMarginSide,d.entityRightWidth+d.timelineRightWidth);a.width=d.posX+e,a.heightParticipant=SEQ.parser.diagram.participantMaxHeight+SEQ.metrics.data.participantMarginTop+SEQ.metrics.data.participantBoxLineWeight}else b.title&&(a.height=b.title.totalHeight,a.width=SEQ.metrics.calcWidth(b.title.title,SEQ.main.getFontTitle())+2*SEQ.metrics.data.textPadding);return a}return{paint:a}}();var SEQ=SEQ||{};SEQ.interactor=function(){function a(a){A=a}function b(a){var b=SEQ.main.getInteractionCanvas(),c=b.getBoundingClientRect();return{x:a.clientX-c.left,y:a.clientY-c.top}}function c(a,b){var c=500,e=200,f=a.pageY,g=a.pageX-c/2;C=document.createElement("div"),C.style.position="absolute",C.style.top=f+"px",C.style.left=g+"px",C.style.zIndex=100;var i=document.createElement("img");i.setAttribute("src","assets/closeicon.png"),i.setAttribute("onclick","SEQ.interactor.cancelAllInteraction()"),i.style.position="relative",i.style.top="-13px",i.style.left="-13px",i.style.width="25px",i.style.height="25px",i.style.zIndex=200,C.appendChild(i);var j=document.createElement("textarea");if(j.id="editEntryTextArea",j.style.position="absolute",j.style.top="0px",j.style.left="0px",j.style.zIndex=101,j.style.width=c+"px",j.style.height=e+"px",j.style.padding="7px",j.onkeydown=h,C.appendChild(j),document.body.appendChild(C),b){j.value=b.replace(/\\n/g,"\n");var k=d(b);j.setSelectionRange(k.start,k.end)}else j.value="info",j.setSelectionRange(0,j.value.length);j.focus()}function d(a){var b=0,c=0,d=a.indexOf(":"),e=a.indexOf("==");return d>-1?(b=d+1,c=a.length):e>-1?(b=2,c=a.length-2):(b=0,c=a.length),{start:b,end:c}}function e(a,b){var c=new RegExp("^"+SEQ.entityParticipant.nameGroup+"$");if(c.exec(b)){for(var d=SEQ.parser.diagram.entries,e="",f=0;f<d.length;f++){var h,i=d[f],j=a.name.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"),k=new RegExp("(^|[^\\w\\d])"+j+"([^\\w\\d]|$)","g");h=i.raw?i.raw.replace(k,"$1"+b+"$2"):i.raw,e+=f===d.length-1?h:h+"\n"}SEQ.main.updateSource(e)}g(),SEQ.parser.parse()}function f(){C&&document.body.removeChild(C),C=null,A=null,B=null,u()}function g(){SEQ.contextMenu.cancel(),SEQ.messageCreator.cancel(),SEQ.entryMover.cancel(),f()}function h(a){if(!a.shiftKey&&13==a.keyCode){a.preventDefault();var b=C.getElementsByTagName("textarea")[0].value;if(document.body.removeChild(C),C=null,B){var c=B.raw;if(B.type==SEQ.entityParticipant.Type.PARTICIPANT)e(B,b);else if(SEQ.entityFragment.regExp.exec(B.type)){var d=c.indexOf(" ");d>-1?B.raw=c.substring(0,c.indexOf(" ")+1)+b.replace(/\n/g,"\\n"):B.raw=c+" "+b.replace(/\n/g,"\\n"),m()}else SEQ.entityDivider.Type.DIVIDER===B.type?(B.raw=SEQ.entityDivider.build(b.replace(/\n/g,"\\n")),m()):(B.raw=c.substring(0,c.indexOf(":")+1)+b.replace(/\n/g,"\\n"),m())}else A&&(A.text=b,n(A))}}function i(a){if(!SEQ.parser.parsingState.ongoing){var b=a.target.tagName;27==a.keyCode?g():46==a.keyCode?B&&k(a,B):187==a.keyCode||171==a.keyCode||107==a.keyCode?"TEXTAREA"!=b&&"INPUT"!=b&&j(.1):189==a.keyCode||173==a.keyCode||109==a.keyCode?"TEXTAREA"!=b&&"INPUT"!=b&&j(-.1):90==a.keyCode&&a.ctrlKey&&a.shiftKey?(a.preventDefault(),SEQ.main.redoChange()):90==a.keyCode&&a.ctrlKey?(a.preventDefault(),SEQ.main.undoChange()):89==a.keyCode&&a.ctrlKey&&(a.preventDefault(),SEQ.main.redoChange())}}function j(a){for(var b=!1,c=SEQ.parser.diagram.entries,d="",e=0;e<c.length;e++){var f=c[e];null!=f.entrySpacing&&(b=!0,f.raw=SEQ.entityEntrySpacing.build(f.entrySpacing+a)),!b&&f.type&&f.type!=SEQ.entityParticipant.Type.PARTICIPANT&&f.type!=SEQ.entityTitle.Type.TITLE&&(d+=SEQ.entityEntrySpacing.build(SEQ.metrics.constants.entrySpacingRatio+a)+"\n",b=!0),d=x(e,c,d,f)}SEQ.main.updateSource(d),SEQ.parser.parse()}function k(a,b){if(!C){a.preventDefault();var c,d=SEQ.parser.diagram.entries;c=SEQ.entityParticipant.isType(b.type)?function(a,b){return a.name===b.fromParticipantName||a.name===b.toParticipantName}:SEQ.entityFragment.isType(b.type)&&SEQ.entityFragment.Type.ELSE!=b.type?function(a,b){return a.fragment==b.fragment}:function(a,b){return a===b};for(var e="",f=0;f<d.length;f++){var g=d[f];c(b,g)||(e=x(f,d,e,g))}SEQ.main.updateSource(e),SEQ.parser.parse()}}function l(){var a=SEQ.parser.diagram.entries,b=!1,c="";D++;for(var d="participant ChangeMe"+D,e=0;e<a.length;e++){var f=a[e];(SEQ.entityNoteBoxLeftRight.isType(f.type)||SEQ.entityMessage.isType(f.type)||SEQ.entityDivider.isType(f.type))&&!b&&(c+=d+"\n",b=!0),c=x(e,a,c,f)}b||(c+="\n"+d),SEQ.main.updateSource(c),SEQ.parser.parse()}function m(){for(var a=SEQ.parser.diagram.entries,b="",c=0;c<a.length;c++){var d=a[c];b=x(c,a,b,d)}SEQ.main.updateSource(b),SEQ.parser.parse()}function n(a){function b(){return SEQ.entityMessage.regExpArrow.exec(a.type)?SEQ.entityMessage.build(a.type,a.fromParticipantName,a.toParticipantName,a.text):SEQ.entityNoteBoxLeftRight.isType(a.type)?a.notePosition===SEQ.entityNoteBoxOver.NotePosition.OVER?SEQ.entityNoteBoxOver.build(a.type,a.participants,a.text):SEQ.entityNoteBoxLeftRight.build(a.type,a.notePosition,a.participants,a.text):SEQ.entityDivider.isType(a.type)?SEQ.entityDivider.build(a.text):SEQ.entityFragment.isType(a.type)?SEQ.entityFragment.build(a.type,a.text):SEQ.entityActivation.isType(a.type)?SEQ.entityActivation.build(a.type,a.participants):SEQ.entitySpace.isType(a.type)?SEQ.entitySpace.build(a.type):void 0}for(var c=SEQ.parser.diagram.entries,d=!1,e="",f=0;f<c.length;f++){var g=c[f];!d&&g.type&&a.posY<g.posY&&(e+=b()+"\n",d=!0),e=x(f,c,e,g)}d||(e+="\n"+b()),a=null,SEQ.main.updateSource(e),SEQ.parser.parse()}function o(a){C||F||(SEQ.messageCreator.finishMessage(a),SEQ.entryMover.finishMove(a))}function p(a){function c(a){return a.buttons?1!=a.buttons:!!a.which&&1!=a.which}if(F=c(a),!C&&!F){SEQ.main.blurEditor();var d=(new Date).getTime();if(d-E<400){var e,f=b(a),g=SEQ.parser.diagram.title?SEQ.parser.diagram.title.totalHeight:0,h=g+SEQ.metrics.data.participantMarginTop;e=f.y>h&&f.y<h+SEQ.parser.diagram.participantMaxHeight?SEQ.entityParticipant.findParticipantXCollision(f.x,f.y,!1):t(f.x,f.y),B==e?r(a):(E=d,q(a))}else E=d,q(a);a.preventDefault()}}function q(a){g();var c=SEQ.main.getInteractionContext();c.save(),c.fillStyle="red",c.strokeStyle="red";var d=b(a),e=SEQ.parser.diagram.title?SEQ.parser.diagram.title.totalHeight:0,f=e+SEQ.metrics.data.participantMarginTop;if(d.y>f&&d.y<f+SEQ.parser.diagram.participantMaxHeight){var h=SEQ.entityParticipant.findParticipantXCollision(d.x,d.y,!1);h&&(B=h,SEQ.entityParticipant.paint(h,c),B.entry&&s(B.entry))}else{var i=t(d.x,d.y);if(i)B=i,i.paint(i,c,!0),s(i),SEQ.entryMover.startMove(a,i);else{var j=SEQ.entityParticipant.findParticipantXCollision(d.x,d.y,!0);j&&SEQ.messageCreator.startMessage(a,j)}}c.restore()}function r(a){if(a.preventDefault(),B)if(B.type==SEQ.entityParticipant.Type.PARTICIPANT)c(a,B.name);else if(SEQ.entityFragment.regExp.exec(B.type))SEQ.entityFragment.Type.END!=B.type&&(B.elseGuard?c(a,B.elseGuard.text):c(a,B.fragment.text));else{var b=SEQ.textUtil.buildInputBoxText(B.textData);c(a,b)}}function s(a){var b,c=SEQ.parser.diagram.entries,e=c.indexOf(a);b=a.type===SEQ.entityParticipant.Type.PARTICIPANT?{start:0,end:a.raw.length}:d(a.raw),SEQ.main.selectInSource(e,b.start,b.end),SEQ.main.focusEditor()}function t(a,b){for(var c=SEQ.parser.diagram,d=c.entries,e=0;e<d.length;e++){var f,g=d[e];if(g.collision&&(f=g.collision(g)),f&&b<f.startY&&b>f.endY&&a>f.startX&&a<f.endX)return g}}function u(){var a=SEQ.main.getInteractionContext();return a.clearRect(0,0,a.canvas.width,a.canvas.height),a}function v(a){C||F||(SEQ.messageCreator.paintMessage(a),SEQ.entryMover.continueMove(a))}function w(a){for(var b=a.target,c=document.getElementsByClassName("openSaveMenu"),d=!1,e=0;e<c.length;e++)c[e].contains(b)&&(d=!0);d||SEQ.saveAndOpen.cancel();var f=document.getElementById("contextMenu");f&&!f.contains(b)&&g()}function x(a,b,c,d){return c+=a===b.length-1?d.raw:d.raw+"\n"}function y(){var a;a="none"==document.getElementById("top").style.display?0:100;var b=SEQ.main.getParticipantCanvas();b.style.top=window.pageYOffset+a+"px"}function z(){var a=SEQ.main.getSyntaxErrorsTextarea(),b=a.value.substr(0,a.selectionStart).split("\n").length;if(SEQ.parser.diagram.errors.length){var c=SEQ.parser.diagram.errors[b-1];SEQ.main.selectInSource(c.lineNumber-1,0,c.line.length)}}var A,B,C,D=0,E=0,F=!1;return{init:function(){var a=SEQ.main.getInteractionCanvas();a.addEventListener("mouseup",o,!1),a.addEventListener("mousedown",p,!1),a.addEventListener("mousemove",v,!1),document.onkeydown=i,document.onmousedown=w,window.onscroll=y,SEQ.main.getSyntaxErrorsTextarea().onclick=z},prependParticipant:l,cancelAllInteraction:g,editEntryTextAreaActive:function(){return null!=C},getMousePosInCanvas:b,displayInputBox:c,setNewEntryData:a,createEntry:n,clearInteractionContext:u,onWindowScroll:y}}();var SEQ=SEQ||{};SEQ.contextMenu=function(){function a(a){if(!SEQ.interactor.editEntryTextAreaActive()){SEQ.interactor.cancelAllInteraction(!0);var f=SEQ.interactor.getMousePosInCanvas(a),j=SEQ.entityParticipant.findParticipantXCollision(f.x,f.y,!1);i={event:a,posY:f.y},h=document.createElement("div"),h.id="contextMenu",document.body.appendChild(h);var k=document.createElement("ul");k.className="contextMenuPart",k.style.width="160px",k.style.top=Math.ceil(a.pageY)+2+"px",k.style.left=Math.ceil(a.pageX)+2+"px",k.onmouseup=g,h.appendChild(k),j&&(e(k,"note",b(SEQ.entityNoteBoxOver.Type.NOTE,j)),e(k,"box",b(SEQ.entityNoteBoxOver.Type.BOX,j)),e(k,"round box",b(SEQ.entityNoteBoxOver.Type.RBOX,j)),e(k,"angular box",b(SEQ.entityNoteBoxOver.Type.ABOX,j)),e(k,"activation",d(j))),e(k,"fragment",c(f)),e(k,"divider",null,SEQ.entityDivider.Type.DIVIDER),e(k,"space",null,SEQ.entitySpace.Type.SPACE)}return a.preventDefault(),!1}function b(a,b){var c=document.createElement("ul");c.className="contextMenuPart contextSubMenuPart",f(c,a,SEQ.entityNoteBoxLeftRight.NotePosition.LEFT,b.name),f(c,a,SEQ.entityNoteBoxLeftRight.NotePosition.RIGHT,b.name),f(c,a,SEQ.entityNoteBoxOver.NotePosition.OVER,b.name);var d=SEQ.parser.diagram.participants;return d.forEach(function(d){d.name!==b.name&&f(c,a,SEQ.entityNoteBoxOver.NotePosition.OVER,b.name+","+d.name)}),h.appendChild(c),c}function c(a){
var b=document.createElement("ul");return b.className="contextMenuPart contextSubMenuPart",f(b,SEQ.entityFragment.Type.ALT),SEQ.entityFragment.insideAlt(a)&&f(b,SEQ.entityFragment.Type.ELSE),f(b,SEQ.entityFragment.Type.OPT),f(b,SEQ.entityFragment.Type.LOOP),f(b,SEQ.entityFragment.Type.PAR),f(b,SEQ.entityFragment.Type.REF),f(b,SEQ.entityFragment.Type.ASSERT),f(b,SEQ.entityFragment.Type.BREAK),f(b,SEQ.entityFragment.Type.CONSIDER),f(b,SEQ.entityFragment.Type.CRITICAL),f(b,SEQ.entityFragment.Type.IGNORE),f(b,SEQ.entityFragment.Type.NEG),f(b,SEQ.entityFragment.Type.SEQ),f(b,SEQ.entityFragment.Type.STRICT),h.appendChild(b),b}function d(a){var b=document.createElement("ul");return b.className="contextMenuPart contextSubMenuPart",f(b,SEQ.entityActivation.Type.ACTIVATE,null,a.name),f(b,SEQ.entityActivation.Type.DEACTIVATE,null,a.name),f(b,SEQ.entityActivation.Type.DEACTIVATE_AFTER,null,a.name),h.appendChild(b),b}function e(a,b,c,d){var e=document.createElement("li");a.appendChild(e),e.className="mainMenuListElement",c?(e.innerHTML='<span style="float: right">&gt;</span>'+b,c.style.top=Math.ceil(e.getBoundingClientRect().top+window.pageYOffset)-2+"px",c.style.left=Math.ceil(a.getBoundingClientRect().right+window.pageXOffset)-2+"px",c.onmouseup=g):e.innerHTML=b,d&&e.setAttribute("data-entry-type",d),e.onmouseover=function(){for(var a=document.getElementsByClassName("contextSubMenuPart"),b=0;b<a.length;b++)a[b].style.display="none";for(var d=document.getElementsByClassName("mainMenuListElement"),f=0;f<d.length;f++)d[f].style.backgroundColor="#ffffff";e.style.backgroundColor="#b0dcea",c&&(c.style.display="block")}}function f(a,b,c,d,e){var f=document.createElement("li");f.setAttribute("data-entry-type",b),d&&f.setAttribute("data-entry-participants",d),c&&f.setAttribute("data-entry-note-position",c),e?f.innerHTML=e:c&&d?f.innerHTML=b+" "+c+" "+d:d?f.innerHTML=b+" "+d:f.innerHTML=b,a.appendChild(f)}function g(a){var b=a.target,c=b.getAttribute("data-entry-type"),d=b.getAttribute("data-entry-note-position"),e=b.getAttribute("data-entry-participants");if(c){document.body.removeChild(h),h=null;var f={participants:e,posY:i.posY,type:c,notePosition:d};SEQ.interactor.setNewEntryData(f),SEQ.entityActivation.isType(c)||SEQ.entitySpace.isType(c)?SEQ.interactor.createEntry(f):SEQ.interactor.displayInputBox(i.event),i=null}}var h,i;return{init:function(){var b=SEQ.main.getInteractionCanvas();b.addEventListener("contextmenu",a,!1)},active:function(){return null!=h},cancel:function(){h&&document.body.removeChild(h),i=null,h=null}}}();var SEQ=SEQ||{};SEQ.messageCreator=function(){function a(a,b){var c=SEQ.interactor.getMousePosInCanvas(a);e={shift:a.shiftKey,ctrl:a.ctrlKey,x:c.x,y:c.y,participant:b}}function b(a){var b=SEQ.interactor.getMousePosInCanvas(a);if(e){var c=SEQ.entityParticipant.findParticipantXCollision(e.x,e.y,!1),d=SEQ.entityParticipant.findParticipantXCollision(b.x,b.y,!1);if(c&&d&&(Math.abs(b.y-e.y)>SEQ.metrics.data.messageCreatorPosDiffThreshold||Math.abs(b.x-e.x)>SEQ.metrics.data.messageCreatorInteractionMargin&&c!=d)){var f;f=d.posX>=c.posX?e.shift?e.ctrl?SEQ.entityMessage.Type.RESP_FORWARD_ASYNC:SEQ.entityMessage.Type.RESP_FORWARD_SYNC:e.ctrl?SEQ.entityMessage.Type.REQ_FORWARD_ASYNC:SEQ.entityMessage.Type.REQ_FORWARD_SYNC:e.shift?e.ctrl?SEQ.entityMessage.Type.RESP_BACKWARD_ASYNC:SEQ.entityMessage.Type.RESP_BACKWARD_SYNC:e.ctrl?SEQ.entityMessage.Type.REQ_BACKWARD_ASYNC:SEQ.entityMessage.Type.REQ_BACKWARD_SYNC;var g=(e.y+b.y)/2,h={fromParticipantName:c.name,toParticipantName:d.name,posY:g,type:f};return SEQ.interactor.setNewEntryData(h),SEQ.interactor.displayInputBox(a),!0}SEQ.interactor.cancelAllInteraction(),e=null}}function c(a){e&&(a.preventDefault(),d(a))}function d(a){var b=SEQ.interactor.clearInteractionContext();if(e){var c=SEQ.interactor.getMousePosInCanvas(a);b.save(),e.shift&&void 0!==b.setLineDash&&b.setLineDash([SEQ.metrics.data.messageLineDashWidth]);var d;if(Math.abs(e.participant.posX-c.x)<SEQ.metrics.data.messageCreatorInteractionMargin&&Math.abs(c.y-e.y)>SEQ.metrics.data.messageCreatorPosDiffThreshold){d=!1,b.beginPath();var f=SEQ.metrics.data.messageSelfRefWidth,g=e.participant.posX;b.moveTo(e.participant.posX,e.y),b.lineTo(g+f,e.y),b.lineTo(g+f,c.y),b.lineTo(c.x,c.y),b.stroke()}else{var h;h=c.x>e.participant.posX?e.participant.posX+e.participant.timelineRightWidth:e.participant.posX-e.participant.timelineLeftWidth;var i=c.x>e.participant.posX?-1*SEQ.metrics.data.messageArrowWidth:SEQ.metrics.data.messageArrowWidth;d=e.participant.posX<c.x,b.beginPath(),b.moveTo(h,e.y),b.lineTo(c.x+i,c.y),b.stroke()}b.restore(),SEQ.entityMessage.paintArrowHead(c.y,d,c.x,b,e.ctrl)}}var e;return{init:function(){var a=SEQ.main.getInteractionCanvas();a.addEventListener("contextmenu",onCanvasContextMenu,!1)},cancel:function(){e=null},startMessage:a,finishMessage:b,paintMessage:c}}();var SEQ=SEQ||{};SEQ.entryMover=function(){function a(a){i&&(r=0,s=0,a.clientY<50?s=-20:a.clientY>window.innerHeight-50&&(s=20),a.clientX<50?r=-20:a.clientX>window.innerWidth-50&&(r=20),0!=r||0!=s?t||(t=!0,u()):t=!1)}function b(a,b){if(b.calcPosX){var c=b.calcPosX(b);k=c.fromX,l=c.toX}i=null,o=!1,p=!1,q=!1,j=b;var d=SEQ.interactor.getMousePosInCanvas(a);b.toParticipantName?(Math.abs(d.x-l)<SEQ.metrics.data.entryMoverXCollisionWidth&&(p=!0),Math.abs(d.x-k)<SEQ.metrics.data.entryMoverXCollisionWidth&&(o=!0),o&&p&&(Math.abs(d.x-l)>Math.abs(d.x-k)?(p=!1,o=!0):(p=!0,o=!1))):b.notePosition===SEQ.entityNoteBoxOver.NotePosition.OVER?Math.abs(d.x-k)>b.totalWidth/2-1.5*SEQ.metrics.data.entryMoverXCollisionWidth?(l=k,q=!0,d.x>k?p=!0:o=!0):o=!0:b.fromParticipantName&&(o=!0),m=j.posY-d.y,n=d}function c(a){return Math.abs(n.y-a.y)>SEQ.metrics.data.entryMoverThreshold||Math.abs(n.x-a.x)>SEQ.metrics.data.entryMoverThreshold}function d(){j=null,i=null,o=!1,p=!1,t=!1,r=0,s=0,window.removeEventListener("mousemove",a,!1)}function e(a){var b=SEQ.interactor.getMousePosInCanvas(a);if(i&&c(b)){var e=i.raw;if(o){var g=SEQ.entityParticipant.findParticipantXCollision(b.x,b.y,!0);g&&(i.notePosition===SEQ.entityNoteBoxOver.NotePosition.OVER&&i.toParticipantName===g.name?(i.fromParticipantName=g.name,i.toParticipantName=null):i.fromParticipantName=g.name,e=i.buildRaw(i))}else if(p){var h=SEQ.entityParticipant.findParticipantXCollision(b.x,b.y,!0);h&&(i.notePosition===SEQ.entityNoteBoxOver.NotePosition.OVER&&i.fromParticipantName===h.name?(i.fromParticipantName=h.name,i.toParticipantName=null):i.toParticipantName=h.name,e=i.buildRaw(i))}for(var k=SEQ.parser.diagram.entries,l=!1,n="",q=0;q<k.length;q++){var r=k[q];!l&&r.type&&b.y+m<r.posY&&(n=f(q,n,e),l=!0,0===q&&(n+="\n")),r!=j&&(n=f(q,n,r.raw))}l||(n+="\n"+e),SEQ.main.updateSource(n),SEQ.parser.parse()}i&&SEQ.interactor.clearInteractionContext(),d()}function f(a,b,c){return b+=0===a?c:"\n"+c}function g(b){if(b.preventDefault(),j&&!i){var d=SEQ.interactor.getMousePosInCanvas(b);c(d)&&(window.addEventListener("mousemove",a,!1),i=JSON.parse(JSON.stringify(j)),i.paint=j.paint,i.updatePos=j.updatePos,i.buildRaw=j.buildRaw,q&&(i.toParticipantName=i.fromParticipantName))}else i&&h(b)}function h(a){var b=SEQ.interactor.clearInteractionContext();if(i){var c=SEQ.interactor.getMousePosInCanvas(a);b.save(),b.globalAlpha=.5,o?i.updatePos(i,c.y+m,c.x,l):p?i.updatePos(i,c.y+m,k,c.x):i.updatePos(i,c.y+m,k,l),i.paint(i,b,!1,!0),b.restore()}}var i,j,k,l,m,n,o,p,q,r,s,t=!1,u=function(){0==r&&0==s||!i||(window.scrollBy(r,s),setTimeout(u,40))};return{cancel:function(){d()},startMove:b,finishMove:e,continueMove:g}}();var SEQ=SEQ||{};SEQ.textUtil=function(){function a(a,b){var c=a.split("\\n"),d=0,e=0,f=!1,g=!1,k=j.normal,l=[];c.forEach(function(a){var b=0;a=a.replace(/\\(\+|\-|\/|\*)/g,"=-=ESCAPE_CHAR_BEGIN=-=$1=-=ESCAPE_CHAR_END=-=");var c,m=a.split(/(\*\*|\/\/|\+\+|\-\-)/),n=[],o=0;m.forEach(function(a){if("**"===a)f=!f;else if("//"!==a||c&&(c.indexOf("http:")>-1||c.indexOf("https:")>-1||c.indexOf("ftp:")>-1||c.indexOf("gopher:")>-1||c.indexOf("file:")>-1))if("--"===a)k=k===j.small?j.normal:j.small;else if("++"===a)k=k===j.big?j.normal:j.big;else{var d,e;j.small==k?(d=SEQ.main.getFontSmall(),e=SEQ.metrics.data.textSmallLineHeight):j.big==k?(d=SEQ.main.getFontBig(),e=SEQ.metrics.data.textBigLineHeight):(d=SEQ.main.getFontNormal(),e=SEQ.metrics.data.textLineHeight),f&&(d=h+d),g&&(d=i+d),a=a.replace(/=-=ESCAPE_CHAR_BEGIN=-=(.)=-=ESCAPE_CHAR_END=-=/g,"$1");var l=SEQ.metrics.calcWidth(a,d);b+=l,n.push({part:a,font:d,width:l,height:e}),e>o&&(o=e)}else g=!g;c=a}),e+=o,l.push({partsWithFonts:n,lineMaxHeight:o,lineWidth:b}),b>d&&(d=b)});var m;return b&&(m=SEQ.metrics.calcWidth(b+" ","bold "+SEQ.main.getFontNormal()),d+=m),{parsedLines:l,lines:c,width:d,height:e+SEQ.metrics.data.textTopBottomPadding,autoNumberWidth:m}}function b(a,b,d,f,g,h,i){a.save(),i&&c(a,b,d,f,g,h,i),e(a,b,d,f,g,h),a.restore()}function c(a,b,c,d,e,f){var g=d+SEQ.metrics.data.textTopBottomPadding/2-SEQ.metrics.data.textPosYOffset,h=!0;b.forEach(function(b){var d,i;h&&e&&f?(c+=f,d=c-f-SEQ.metrics.data.textTopBottomPadding/2,i=b.lineWidth+SEQ.metrics.data.textTopBottomPadding+f,h=!1):(d=c-SEQ.metrics.data.textTopBottomPadding/2,i=b.lineWidth+SEQ.metrics.data.textTopBottomPadding),a.save(),a.fillStyle="white",a.beginPath(),a.fillRect(d,g+SEQ.metrics.data.textPosYOffset-SEQ.metrics.data.textTopBottomPadding/2,i,b.lineMaxHeight+SEQ.metrics.data.textTopBottomPadding),a.restore(),g+=b.lineMaxHeight})}function d(a,b,c,d){var e=d;b.forEach(function(b){var d=b.partsWithFonts;e+=b.lineMaxHeight;var f=0;d.forEach(function(b){a.font=b.font,f+=b.width});var g=c-f/2;d.forEach(function(b){a.font=b.font,a.fillText(b.part,g,e),g+=b.width})})}function e(a,b,c,d,e,f){e&&f&&(c+=f);var g=d-SEQ.metrics.data.textPosYOffset,h=!0;b.forEach(function(b){var d=b.partsWithFonts;g+=b.lineMaxHeight;var i=c;if(d.forEach(function(b){a.font=b.font,a.fillText(b.part,i,g),i+=b.width}),e&&h){a.save(),a.font="bold "+SEQ.main.getFontNormal();var j=e+" ";a.fillText(j,c-f,g),a.restore(),h=!1}})}function f(a){var b="",c=0;return a.lines.forEach(function(d){b+=d,c<a.lines.length-1&&(b+="\\n"),c++}),b}function g(a){var b="",c=0;return a.lines.forEach(function(d){b+=d,c<a.lines.length-1&&(b+="\n"),c++}),b}var h="bold ",i="italic ",j={normal:"normal",small:"small",big:"big"};return{parseTextData:a,buildInputBoxText:g,buildSourceText:f,fillText:b,fillTextParticipant:d}}();var SEQ=SEQ||{};SEQ.participantTypes=function(){function a(a,b,c,d,e,f,g,h){for(var i=g;i<h;i+=.01){var j=b-e*Math.sin(i)*Math.sin(f)+d*Math.cos(i)*Math.cos(f),k=c+d*Math.cos(i)*Math.sin(f)+e*Math.sin(i)*Math.cos(f);0==i?a.moveTo(j,k):a.lineTo(j,k)}}function b(a,b){a.color?b.fillStyle=a.color:b.fillStyle="white",b.fill()}function c(){return 3.14*SEQ.metrics.data.baseSpaceMetric-SEQ.metrics.data.participantTypeLineWeight}return{actor:{paint:function(a,c,d,e){var f=c.longNameTextData?c.longNameTextData.height:SEQ.metrics.data.textLineHeight+SEQ.metrics.data.textTopBottomPadding,g=SEQ.metrics.data.baseSpaceMetric,h=d+e-f,i=3.5*g,j=.57*g,k=1.22*g,l=.72*g,m=.44*g+2*j;a.save(),a.lineWidth=SEQ.metrics.data.participantTypeLineWeight,a.beginPath(),a.arc(c.posX,h-i+j,j,0,2*Math.PI),a.moveTo(c.posX,h-i+2*j),a.lineTo(c.posX,h-i+2*j+k),a.moveTo(c.posX-l,h-i+m),a.lineTo(c.posX+l,h-i+m),a.moveTo(c.posX,h-i+2*j+k),a.lineTo(c.posX-l,h),a.moveTo(c.posX,h-i+2*j+k),a.lineTo(c.posX+l,h),b(c,a),a.stroke(),a.restore()},width:function(){return.72*SEQ.metrics.data.baseSpaceMetric*2},height:function(){return 3.5*SEQ.metrics.data.baseSpaceMetric+SEQ.metrics.data.participantTypeLineWeight/2}},boundary:{paint:function(a,d,e,f){var g=d.longNameTextData?d.longNameTextData.height:SEQ.metrics.data.textLineHeight+SEQ.metrics.data.textTopBottomPadding,h=c(),i=f+e-g-h/2-SEQ.metrics.data.participantTypeLineWeight/2,j=h/2,k=SEQ.metrics.data.baseSpaceMetric/2;a.save(),a.lineWidth=SEQ.metrics.data.participantTypeLineWeight,a.beginPath(),a.arc(d.posX+k,i,j,0,2*Math.PI),a.moveTo(d.posX-j-k+SEQ.metrics.data.participantTypeLineWeight/2,i-j-SEQ.metrics.data.participantTypeLineWeight/2),a.lineTo(d.posX-j-k+SEQ.metrics.data.participantTypeLineWeight/2,i+j+SEQ.metrics.data.participantTypeLineWeight/2),a.moveTo(d.posX-j-k,i),a.lineTo(d.posX-j+k,i),b(d,a),a.stroke(),a.restore()},width:function(){return c()+SEQ.metrics.data.baseSpaceMetric/2+SEQ.metrics.data.participantTypeLineWeight},height:function(){return c()+SEQ.metrics.data.participantTypeLineWeight}},control:{paint:function(a,d,e,f){var g=d.longNameTextData?d.longNameTextData.height:SEQ.metrics.data.textLineHeight+SEQ.metrics.data.textTopBottomPadding,h=c(),i=f+e-g-h/2-SEQ.metrics.data.participantTypeLineWeight/2,j=h/2,k=.6*SEQ.metrics.data.baseSpaceMetric,l=SEQ.metrics.data.baseSpaceMetric/2,m=d.posX-.2*SEQ.metrics.data.baseSpaceMetric;a.save(),a.lineWidth=SEQ.metrics.data.participantTypeLineWeight,a.beginPath(),a.arc(d.posX,i,j,0,2*Math.PI),a.moveTo(m,i-j),a.lineTo(m+k,i-j-l),a.moveTo(m,i-j),a.lineTo(m+k,i-j+l),b(d,a),a.stroke(),a.restore()},width:function(){return c()+SEQ.metrics.data.participantTypeLineWeight},height:function(){return c()+SEQ.metrics.data.participantTypeLineWeight+SEQ.metrics.data.baseSpaceMetric/2}},entity:{paint:function(a,d,e,f){var g=d.longNameTextData?d.longNameTextData.height:SEQ.metrics.data.textLineHeight+SEQ.metrics.data.textTopBottomPadding,h=c(),i=f+e-g-h/2-SEQ.metrics.data.participantTypeLineWeight/2,j=h/2;a.save(),a.lineWidth=SEQ.metrics.data.participantTypeLineWeight,a.beginPath(),a.arc(d.posX,i-.8*SEQ.metrics.data.participantTypeLineWeight,j,0,2*Math.PI),a.moveTo(d.posX-j-SEQ.metrics.data.participantTypeLineWeight/2,i+j),a.lineTo(d.posX+j-SEQ.metrics.data.participantTypeLineWeight/2,i+j),b(d,a),a.stroke(),a.restore()},width:function(){return c()+SEQ.metrics.data.participantTypeLineWeight},height:function(){return c()+1.8*SEQ.metrics.data.participantTypeLineWeight}},database:{paint:function(c,d,e,f){var g=d.longNameTextData?d.longNameTextData.height:SEQ.metrics.data.textLineHeight+SEQ.metrics.data.textTopBottomPadding,h=SEQ.metrics.data.baseSpaceMetric,i=e+f-g,j=3.42*h,k=.66*h,l=2.92*h,m=1.46*h,n=.073*h;c.save(),c.lineWidth=SEQ.metrics.data.participantTypeLineWeight,c.beginPath(),c.moveTo(d.posX-l/2,i-k),c.lineTo(d.posX-l/2,i-j+k),c.lineTo(d.posX+l/2,i-j+k),c.lineTo(d.posX+l/2,i-k),b(d,c),c.stroke(),c.beginPath(),a(c,d.posX,i-j+k-n,m,k,0,0,2*Math.PI),a(c,d.posX,i-k-n,m,k,0,0,Math.PI),b(d,c),c.stroke(),c.restore()},width:function(){return 4*SEQ.metrics.data.baseSpaceMetric},height:function(){return 3.42*SEQ.metrics.data.baseSpaceMetric+SEQ.metrics.data.participantTypeLineWeight}}}}();var SEQ=SEQ||{};SEQ.saveAndOpen=function(){function a(){document.getElementById("saveSourceMenu").style.display="none",document.getElementById("openSourceMenu").style.display="none"}function b(b){var c=b.files;if(window.File&&window.FileReader&&window.FileList&&window.Blob){var d=c[0],e=new FileReader;e.onload=function(c){SEQ.main.updateSource(c.target.result),SEQ.main.parse(),b.form.reset(),a()},e.readAsText(d)}else alert("The JavaScript file APIs are not fully supported in this browser.")}function c(b){var c=this.diagramName;if("delete"===b.target.innerHTML){var d=confirm('Are you sure you want to delete "'+c+'"?');d&&(localStorage.removeItem(c),h())}else{var e=localStorage.getItem(c);SEQ.main.updateSource(e),SEQ.main.parse(),a()}}function d(){var b=document.getElementById("fileName").value,c=SEQ.main.getSourceValue();navigator.appVersion.indexOf("Win")!=-1&&(c=c.replace(/\n/g,"\r\n"));var d=new Blob([c],{type:"text/plain"});if(navigator.msSaveBlob)navigator.msSaveBlob(d,b);else{var e=document.createElement("a");e.download=b,e.innerHTML="download source",e.onclick=function(a){document.body.removeChild(a.target)};var f=window.URL||window.webkitURL;e.href=f.createObjectURL(d),e.style.display="none",document.body.appendChild(e),e.click()}a()}function e(){var a=(SEQ.parser.diagram.title?SEQ.parser.diagram.title.title:"no title")+".png",b=SEQ.main.getDiagramCanvas();if(b.msToBlob){var c=b.msToBlob();window.navigator.msSaveBlob(c,a)}else{var d=document.getElementById("pnghq"),e=b.toDataURL("image/png");d.download=a,d.href=e}}function f(){var a=(SEQ.parser.diagram.title?SEQ.parser.diagram.title.title:"no title")+".jpg",b=SEQ.main.getDiagramCanvas(),c=b.toDataURL("image/jpeg",.1),d=document.getElementById("jpglq");if(b.msToBlob){var e=window.open("about:blank");e.document.write("<img src='"+c+"'/>")}else d.download=a,d.href=c}function g(){var a=(SEQ.parser.diagram.title?SEQ.parser.diagram.title.title:"no title")+".svg",b=SEQ.main.getDiagramCanvas(),c=new C2S(b.width,b.height);SEQ.main.setCanvasToSvgContext(c),SEQ.parser.parse();var d=c.getSerializedSvg(),e="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(d);if(SEQ.main.setCanvasToSvgContext(null),SEQ.parser.parse(),b.msToBlob)window.alert("Please use Chrome or Firefox for svg export");else{var f=document.createElement("a");f.onclick=function(a){document.body.removeChild(a.target)},f.href=e,f.download=a,f.style.display="none",document.body.appendChild(f),f.click()}}function h(a){if(a){var b=a.getBoundingClientRect(),d=document.getElementById("openSourceMenu");d.style.top=b.top+"px",d.style.left=b.right+"px",d.style.display="block"}for(var e=document.getElementById("localStorageSources");e.firstChild;)e.removeChild(e.firstChild);var f=document.createElement("table");if(e.appendChild(f),localStorage.length)for(var g=0;g<localStorage.length;g++){var h=document.createElement("tr");h.diagramName=localStorage.key(g);var i=document.createElement("td");i.innerHTML=localStorage.key(g)+"&nbsp;",h.onclick=c,h.appendChild(i);var j=document.createElement("td");j.style.textAlign="right";var k=document.createElement("button");k.innerHTML="delete",j.appendChild(k),h.appendChild(j),f.appendChild(h)}else{var l=document.createElement("span");l.innerHTML="no diagrams found",e.appendChild(l)}}return{saveSource:function(a){var b=a.getBoundingClientRect(),c=document.getElementById("saveSourceMenu");c.style.display="block",c.style.top=b.top+"px",c.style.left=b.right+"px";var d=document.getElementById("fileName");d.focus(),d.select();var e=SEQ.parser.diagram.title?SEQ.parser.diagram.title.title:"no title";document.getElementById("fileName").value=e+".txt"},openSource:h,openSourceFromFile:b,saveSourceIntoFile:d,saveSourceIntoLocalStorage:function(){var b=document.getElementById("fileName").value;localStorage.setItem(b,SEQ.main.getSourceValue()),a()},openSourceFromLocalStorage:c,savePngHq:e,saveJpgLq:f,saveSvg:g,create:function(a){localStorage.setItem(a,SEQ.main.getSourceValue())},cancel:a}}();var SEQ=SEQ||{};SEQ.seqDiaHint=function(){"use strict";function a(){b(SEQ.entityNoteBoxOver,e),b(SEQ.entityNoteBoxLeftRight,e),b(SEQ.entityActivation,e),b(SEQ.entityDivider,f),b(SEQ.entityFragment,f),b(SEQ.entityTitle,f),b(SEQ.entityParticipant,f),b(SEQ.entityLinear,f),b(SEQ.entityParallel,f),b(SEQ.entityAutoNumber,f),b(SEQ.entityFontFamily,f),b(SEQ.entityFontSize,f),b(SEQ.entitySpace,f),b(SEQ.entityParticipantSpacing,f),b(SEQ.entityEntrySpacing,f),b(SEQ.entityMessage,g)}function b(a,b){if(a.NotePosition){for(var c in a.Type)if(a.Type.hasOwnProperty(c))for(var d in a.NotePosition)a.NotePosition.hasOwnProperty(d)&&b.push(a.Type[c]+" "+a.NotePosition[d])}else for(var e in a.Type)a.Type.hasOwnProperty(e)&&b.push(a.Type[e])}function c(a){for(var b=0;b<e.length;b++){var c=e[b];if(0===a.replace(/^\s+/,"").lastIndexOf(c+" "))return{participantPart:a.replace(c,"").trim(),start:a.indexOf(c)+c.length+1}}return!1}function d(a){var b,d=a.getCursor(),h=a.getLine(d.line).substring(0,d.ch),i=[],j=d.ch,k=j;if(SEQ.entityMessage.regExpArrow.test(h)){for(;k&&">"!==h.charAt(k-1)&&"-"!==h.charAt(k-1);)k--;b=h.slice(k,j).trim(),SEQ.parser.diagram.participants.forEach(function(a){0===a.name.lastIndexOf(b,0)&&i.push(a.name)})}else if(SEQ.parser.diagram.participantsByName[h.trim()])i=g;else{for(k=0;" "===h.charAt(k);)k++;if(b=h.replace(/^\s+/,""),0===b.length)SEQ.parser.diagram.participants.forEach(function(a){i.push(a.name)}),e.forEach(function(a){i.push(a+" ")}),f.forEach(function(a){i.push(a+" ")});else if("#"===b.charAt(0)||":"===b.charAt(b.length-1));else{var l=c(h);l?(k=l.start,SEQ.parser.diagram.participants.forEach(function(a){0===a.name.lastIndexOf(l.participantPart,0)&&i.push(a.name)})):(SEQ.parser.diagram.participants.forEach(function(a){0===a.name.lastIndexOf(b,0)&&i.push(a.name)}),e.forEach(function(a){0===a.indexOf(b.trim(),0)&&i.push(a+" ")}),f.forEach(function(a){0===a.indexOf(b.trim(),0)&&i.push(a+" ")}))}}return{list:i,from:CodeMirror.Pos(d.line,k),to:CodeMirror.Pos(d.line,j)}}var e=[],f=[],g=[];return{init:function(){a(),CodeMirror.registerHelper("hint","seqdiahint",function(a){return d(a)})}}}();var SEQ=SEQ||{};SEQ.seqDiaMode=function(){"use strict";function a(){var a=function(a){for(var b;!b&&a.currentGroup<a.maxGroup;)a.currentGroup++,b=a.match[a.currentGroup];return b?(a.pos=a.string.indexOf(b,a.pos)+b.length,a.groupMapping[a.currentGroup].style):void a.skipToEnd()},b={};b.regExp=SEQ.entityMessage.regExp,b.maxGroup=SEQ.entityMessage.groups.TEXT,b.handleSecondPartOfType=!1,b.groupMapping={},b.groupMapping[SEQ.entityMessage.groups.PARTICIPANT_1]={style:c.ACTOR},b.groupMapping[SEQ.entityMessage.groups.TYPE]={style:c.ARROW},b.groupMapping[SEQ.entityMessage.groups.COLOR_HEX_3]={style:c.COLOR},b.groupMapping[SEQ.entityMessage.groups.COLOR_NAME_4]={style:c.COLOR},b.groupMapping[SEQ.entityMessage.groups.COLOR_HEX_5]={style:c.COLOR},b.groupMapping[SEQ.entityMessage.groups.COLOR_NAME_6]={style:c.COLOR},b.groupMapping[SEQ.entityMessage.groups.COLOR_HEX_7]={style:c.COLOR},b.groupMapping[SEQ.entityMessage.groups.COLOR_NAME_8]={style:c.COLOR},b.groupMapping[SEQ.entityMessage.groups.PARTICIPANT_2]={style:c.ACTOR},b.groupMapping[SEQ.entityMessage.groups.TEXT]={style:c.TEXT},b.progressStream=function(a){if(a.handleSecondPartOfType)return a.pos+=a.typeMatchPart.length-a.typeMatchPart.indexOf("#")-a.colorLength,a.handleSecondPartOfType=!1,b.groupMapping[SEQ.entityMessage.groups.TYPE].style;for(var c;!c&&a.currentGroup<a.maxGroup;)a.currentGroup++,c=a.match[a.currentGroup];if(c){var d=a.groupMapping[a.currentGroup];if(a.currentGroup===SEQ.entityMessage.groups.TYPE&&c.indexOf("#")!==-1)return a.pos+=c.indexOf("#"),a.typeMatchPart=c,b.groupMapping[SEQ.entityMessage.groups.TYPE].style;if(a.currentGroup>=SEQ.entityMessage.groups.COLOR_HEX_3&&a.currentGroup<=SEQ.entityMessage.groups.COLOR_NAME_8){var e=c.length;return c.indexOf("#")===-1&&(e+=1),a.pos+=e,a.colorLength=e,a.handleSecondPartOfType=!0,d.style}return a.pos=a.string.indexOf(c,a.pos)+c.length,d.style}a.skipToEnd()},d.push(b);var e={};e.regExp=SEQ.entityNoteBoxOver.regExp,e.maxGroup=SEQ.entityNoteBoxOver.groups.TEXT,e.groupMapping={},e.groupMapping[SEQ.entityNoteBoxOver.groups.TYPE]={style:c.KEYWORD},e.groupMapping[SEQ.entityNoteBoxOver.groups.SIDE]={style:c.KEYWORD},e.groupMapping[SEQ.entityNoteBoxOver.groups.PARTICIPANT_FROM]={style:c.ACTOR},e.groupMapping[SEQ.entityNoteBoxOver.groups.PARTICIPANT_TO]={style:c.ACTOR},e.groupMapping[SEQ.entityNoteBoxOver.groups.COLOR_HEX]={style:c.COLOR},e.groupMapping[SEQ.entityNoteBoxOver.groups.COLOR_NAME]={style:c.COLOR},e.groupMapping[SEQ.entityNoteBoxOver.groups.TEXT]={style:c.TEXT},e.progressStream=a,d.push(e);var f={};f.regExp=SEQ.entityNoteBoxLeftRight.regExp,f.maxGroup=SEQ.entityNoteBoxLeftRight.groups.TEXT,f.groupMapping={},f.groupMapping[SEQ.entityNoteBoxLeftRight.groups.TYPE]={style:c.KEYWORD},f.groupMapping[SEQ.entityNoteBoxLeftRight.groups.SIDE]={style:c.KEYWORD},f.groupMapping[SEQ.entityNoteBoxLeftRight.groups.PARTICIPANT_FROM]={style:c.ACTOR},f.groupMapping[SEQ.entityNoteBoxLeftRight.groups.COLOR_HEX]={style:c.COLOR},f.groupMapping[SEQ.entityNoteBoxLeftRight.groups.COLOR_NAME]={style:c.COLOR},f.groupMapping[SEQ.entityNoteBoxLeftRight.groups.TEXT]={style:c.TEXT},f.progressStream=a,d.push(f);var g={};g.regExp=SEQ.entityFragment.regExp,g.maxGroup=SEQ.entityFragment.groups.TEXT,g.groupMapping={},g.groupMapping[SEQ.entityFragment.groups.OPERATOR]={style:c.KEYWORD},g.groupMapping[SEQ.entityFragment.groups.TEXT]={style:c.TEXT},g.progressStream=a,d.push(g);var h={};h.regExp=SEQ.entityActivation.regExp,h.maxGroup=SEQ.entityActivation.groups.COLOR_NAME,h.groupMapping={},h.groupMapping[SEQ.entityActivation.groups.TYPE]={style:c.KEYWORD},h.groupMapping[SEQ.entityActivation.groups.PARTICIPANT]={style:c.ACTOR},h.groupMapping[SEQ.entityActivation.groups.COLOR_HEX]={style:c.COLOR},h.groupMapping[SEQ.entityActivation.groups.COLOR_NAME]={style:c.COLOR},h.progressStream=a,d.push(h);var i={};i.regExp=SEQ.entityAutoNumber.regExp,i.maxGroup=SEQ.entityAutoNumber.groups.STATUS,i.groupMapping={},i.groupMapping[SEQ.entityAutoNumber.groups.AUTO_NUMBER]={style:c.KEYWORD},i.groupMapping[SEQ.entityAutoNumber.groups.STATUS]={style:c.KEYWORD},i.progressStream=a,d.push(i);var j={};j.regExp=SEQ.entityDivider.regExp,j.maxGroup=SEQ.entityDivider.groups.COLOR_NAME,j.groupMapping={},j.groupMapping[SEQ.entityDivider.groups.EQUALS_1]={style:c.KEYWORD},j.groupMapping[SEQ.entityDivider.groups.TEXT]={style:c.TEXT},j.groupMapping[SEQ.entityDivider.groups.EQUALS_2]={style:c.KEYWORD},j.groupMapping[SEQ.entityDivider.groups.COLOR_HEX]={style:c.COLOR},j.groupMapping[SEQ.entityDivider.groups.COLOR_NAME]={style:c.COLOR},j.progressStream=a,d.push(j);var k={};k.regExp=SEQ.entityEntrySpacing.regExp,k.maxGroup=SEQ.entityEntrySpacing.groups.SPACING,k.groupMapping={},k.groupMapping[SEQ.entityEntrySpacing.groups.ENTRY_SPACING]={style:c.KEYWORD},k.groupMapping[SEQ.entityEntrySpacing.groups.SPACING]={style:c.TEXT},k.progressStream=a,d.push(k);var l={};l.regExp=SEQ.entityFontFamily.regExp,l.maxGroup=SEQ.entityFontFamily.groups.NAME,l.groupMapping={},l.groupMapping[SEQ.entityFontFamily.groups.FONT_FAMILY]={style:c.KEYWORD},l.groupMapping[SEQ.entityFontFamily.groups.NAME]={style:c.TEXT},l.progressStream=a,d.push(l);var m={};m.regExp=SEQ.entityFontSize.regExp,m.maxGroup=SEQ.entityFontSize.groups.SIZE,m.groupMapping={},m.groupMapping[SEQ.entityFontSize.groups.FONT_SIZE]={style:c.KEYWORD},m.groupMapping[SEQ.entityFontSize.groups.SIZE]={style:c.TEXT},m.progressStream=a,d.push(m);var n={};n.regExp=SEQ.entityLinear.regExp,n.maxGroup=SEQ.entityLinear.groups.STATUS,n.groupMapping={},n.groupMapping[SEQ.entityLinear.groups.LINEAR]={style:c.KEYWORD},n.groupMapping[SEQ.entityLinear.groups.STATUS]={style:c.TEXT},n.progressStream=a,d.push(n);var o={};o.regExp=SEQ.entityParallel.regExp,o.maxGroup=SEQ.entityParallel.groups.STATUS,o.groupMapping={},o.groupMapping[SEQ.entityParallel.groups.PARALLEL]={style:c.KEYWORD},o.groupMapping[SEQ.entityParallel.groups.STATUS]={style:c.TEXT},o.progressStream=a,d.push(o);var p={};p.regExp=SEQ.entityParticipant.regExp,p.maxGroup=SEQ.entityParticipant.groups.COLOR_NAME,p.groupMapping={},p.groupMapping[SEQ.entityParticipant.groups.TYPE]={style:c.KEYWORD},p.groupMapping[SEQ.entityParticipant.groups.QUOTE_1]={style:c.KEYWORD},p.groupMapping[SEQ.entityParticipant.groups.LONG_NAME]={style:c.TEXT},p.groupMapping[SEQ.entityParticipant.groups.QUOTE_2]={style:c.KEYWORD},p.groupMapping[SEQ.entityParticipant.groups.AS]={style:c.KEYWORD},p.groupMapping[SEQ.entityParticipant.groups.ALIAS]={style:c.ACTOR},p.groupMapping[SEQ.entityParticipant.groups.COLOR_HEX]={style:c.COLOR},p.groupMapping[SEQ.entityParticipant.groups.COLOR_NAME]={style:c.COLOR},p.progressStream=a,d.push(p);var q={};q.regExp=SEQ.entityParticipantSpacing.regExp,q.maxGroup=SEQ.entityParticipantSpacing.groups.SPACING,q.groupMapping={},q.groupMapping[SEQ.entityParticipantSpacing.groups.PARTICIPANT_SPACING]={style:c.KEYWORD},q.groupMapping[SEQ.entityParticipantSpacing.groups.SPACING]={style:c.TEXT},q.progressStream=a,d.push(q);var r={};r.regExp=SEQ.entitySpace.regExp,r.maxGroup=SEQ.entitySpace.groups.VALUE,r.groupMapping={},r.groupMapping[SEQ.entitySpace.groups.SPACE]={style:c.KEYWORD},r.groupMapping[SEQ.entitySpace.groups.VALUE]={style:c.TEXT},r.progressStream=a,d.push(r);var s={};s.regExp=SEQ.entityTitle.regExp,s.maxGroup=SEQ.entityTitle.groups.VALUE,s.groupMapping={},s.groupMapping[SEQ.entityTitle.groups.TITLE]={style:c.KEYWORD},s.groupMapping[SEQ.entityTitle.groups.VALUE]={style:c.TEXT},s.progressStream=a,d.push(s);var t={};t.regExp=SEQ.parser.regExpComment,t.maxGroup=1,t.groupMapping={},t.groupMapping[1]={style:c.COMMENT},t.progressStream=a,d.push(t)}function b(a){if(!a.sol())return a.progressStream(a);for(var b=0;b<d.length;b++){var c=d[b],e=a.match(c.regExp,!1,!1);if(e)return a.match=e,a.currentGroup=0,a.maxGroup=c.maxGroup,a.groupMapping=c.groupMapping,a.progressStream=c.progressStream,a.progressStream(a)}a.skipToEnd()}var c={KEYWORD:"def",ACTOR:"tag",COLOR:"bracket",TEXT:"variable",COMMENT:"comment",ERROR:"error",ARROW:"keyword"},d=[];return{init:function(){a(),CodeMirror.defineMode("seqdiamode",function(){return{token:b}})}}}();